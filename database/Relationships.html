<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Relationships |  Ruby on Rails Documentattion </title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="RoR Documentation for Beginners">
    
    <link rel="preload" href="/assets/css/0.styles.d6ad21ed.css" as="style"><link rel="preload" href="/assets/js/app.7adc5413.js" as="script"><link rel="preload" href="/assets/js/2.72a95a92.js" as="script"><link rel="preload" href="/assets/js/17.842c0f28.js" as="script"><link rel="prefetch" href="/assets/js/10.a520d8be.js"><link rel="prefetch" href="/assets/js/11.f290d03c.js"><link rel="prefetch" href="/assets/js/12.52c96c43.js"><link rel="prefetch" href="/assets/js/13.2df3af10.js"><link rel="prefetch" href="/assets/js/14.840b181d.js"><link rel="prefetch" href="/assets/js/15.71342207.js"><link rel="prefetch" href="/assets/js/16.9d4ff7c3.js"><link rel="prefetch" href="/assets/js/18.93bc7927.js"><link rel="prefetch" href="/assets/js/19.5935f0d0.js"><link rel="prefetch" href="/assets/js/20.cdf58d7d.js"><link rel="prefetch" href="/assets/js/21.3166d2bf.js"><link rel="prefetch" href="/assets/js/22.b1a0c7ae.js"><link rel="prefetch" href="/assets/js/23.df366c28.js"><link rel="prefetch" href="/assets/js/24.fc6d5a86.js"><link rel="prefetch" href="/assets/js/25.2115eb5e.js"><link rel="prefetch" href="/assets/js/26.a5569d65.js"><link rel="prefetch" href="/assets/js/27.214f9614.js"><link rel="prefetch" href="/assets/js/28.6263065f.js"><link rel="prefetch" href="/assets/js/29.0f98370e.js"><link rel="prefetch" href="/assets/js/3.447679a1.js"><link rel="prefetch" href="/assets/js/30.1182db89.js"><link rel="prefetch" href="/assets/js/31.38016aaf.js"><link rel="prefetch" href="/assets/js/32.626ffe2b.js"><link rel="prefetch" href="/assets/js/33.039db41a.js"><link rel="prefetch" href="/assets/js/34.76b65e88.js"><link rel="prefetch" href="/assets/js/35.1f504bd2.js"><link rel="prefetch" href="/assets/js/36.2089506c.js"><link rel="prefetch" href="/assets/js/37.54d694f8.js"><link rel="prefetch" href="/assets/js/38.8a179bd0.js"><link rel="prefetch" href="/assets/js/39.3159a702.js"><link rel="prefetch" href="/assets/js/4.fb941f04.js"><link rel="prefetch" href="/assets/js/40.3697d274.js"><link rel="prefetch" href="/assets/js/41.b554a771.js"><link rel="prefetch" href="/assets/js/42.45c82fe7.js"><link rel="prefetch" href="/assets/js/43.b54c5bed.js"><link rel="prefetch" href="/assets/js/44.fbcc36d7.js"><link rel="prefetch" href="/assets/js/5.384b96a2.js"><link rel="prefetch" href="/assets/js/6.d92e70ec.js"><link rel="prefetch" href="/assets/js/7.189f016f.js"><link rel="prefetch" href="/assets/js/8.f4a80106.js"><link rel="prefetch" href="/assets/js/9.1176b470.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d6ad21ed.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name"> Ruby on Rails Documentattion </span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">Ruby on rails</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Getting Started</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Architecture Concepts</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>The Basic</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Database</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/database/" aria-current="page" class="sidebar-link">Database</a></li><li><a href="/database/Configurations.html" class="sidebar-link">Configurations</a></li><li><a href="/database/Active Record ORM.html" class="sidebar-link">Active Record ORM</a></li><li><a href="/database/Active Record Migrations.html" class="sidebar-link">Active Record Migrations</a></li><li><a href="/database/Model.html" class="sidebar-link">Model</a></li><li><a href="/database/Validation.html" class="sidebar-link">Validation</a></li><li><a href="/database/Relationships.html" aria-current="page" class="active sidebar-link">Relationships</a></li><li><a href="/database/Callbacks.html" class="sidebar-link">Callbacks</a></li><li><a href="/database/Query Builder.html" class="sidebar-link">Query Builder</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Digging Deeper</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Security</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Testing</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Packages</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="relationships"><a href="#relationships" class="header-anchor">#</a> Relationships</h1> <ul><li><p>Introduction</p> <p>Database tables are often related to one another. For example, a blog post may have many comments or an order could be related to the user who placed it. Active Record makes managing and working with these relationships easy, and supports a variety of common relationships:</p> <ul><li>One To One</li> <li>One To Many</li> <li>Many To Many</li> <li>Has One Through</li> <li>Has Many Through</li> <li>One To One (Polymorphic)</li> <li>One To Many (Polymorphic)</li> <li>Many To Many (Polymorphic)</li></ul></li> <li><p>Relations</p> <ul><li><p>One to One</p> <p>A one-to-one relationship is a very basic type of database relationship. For example, a <strong><code>User</code></strong>
model might be associated with one **<code>Phone</code>**model. To define this relationship, we will place a <code>has_one</code> phone  on the **<code>User</code>**model.</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token operator">&lt;</span> ApplicationRecord
  has_one <span class="token symbol">:phone</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">Phone</span> <span class="token operator">&lt;</span> ApplicationRecord
   validates_uniqueness_of <span class="token symbol">:user_id</span><span class="token punctuation">,</span> <span class="token symbol">message</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">&quot;can not have more than one phone&quot;</span></span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>The corresponding migration might look like this:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">CreateUsers</span> <span class="token operator">&lt;</span> ActiveRecord<span class="token double-colon punctuation">::</span>Migration<span class="token punctuation">[</span><span class="token number">7.0</span><span class="token punctuation">]</span>
  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">change</span></span>
    create_table <span class="token symbol">:users</span> <span class="token keyword">do</span> <span class="token operator">|</span>t<span class="token operator">|</span>
      t<span class="token punctuation">.</span>string <span class="token symbol">:name</span>
      t<span class="token punctuation">.</span>timestamps
    <span class="token keyword">end</span>

    create_table <span class="token symbol">:phones</span> <span class="token keyword">do</span> <span class="token operator">|</span>t<span class="token operator">|</span>
      t<span class="token punctuation">.</span>belongs_to <span class="token symbol">:user</span>
      t<span class="token punctuation">.</span>string <span class="token symbol">:phone_number</span>
      t<span class="token punctuation">.</span>timestamps
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>Depending on the use case, you might also need to create a unique index and/or a foreign key constraint on the supplier column for the accounts table. In this case, the column definition might look like this:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>create_table <span class="token symbol">:phones</span> <span class="token keyword">do</span> <span class="token operator">|</span>t<span class="token operator">|</span>
  t<span class="token punctuation">.</span>belongs_to <span class="token symbol">:user</span><span class="token punctuation">,</span> <span class="token symbol">index</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token symbol">unique</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token symbol">foreign_key</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token comment"># ...</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>In order to link the resource , you can do by</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>Phone<span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token symbol">user</span><span class="token operator">:</span> User<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">,</span> <span class="token symbol">phone_number</span><span class="token operator">:</span><span class="token string-literal"><span class="token string">'9823432543'</span></span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">#You can also provide id direct</span>
Phone<span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token symbol">user_id</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">,</span> <span class="token symbol">phone_number</span><span class="token operator">:</span><span class="token string-literal"><span class="token string">'9823432543'</span></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>You can access the associated relation by</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>phone <span class="token operator">=</span> User<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>phone
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>Defining inverse of relation:</strong></p> <p>So, we can access the **<code>Phone</code>**model from our **<code>User</code>**model. Next, let's define a relationship on the **<code>Phone</code>**model that will let us access the user that owns the phone. We can define the inverse of a **<code>has_one</code>**relationship using the <strong><code>belongs_to</code></strong> method:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">Phone</span> <span class="token operator">&lt;</span> ApplicationRecord
  belongs_to <span class="token symbol">:user</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>One to Many</p> <p>A one-to-many relationship is used to define relationships where a single model is the parent to one or more child models. For example, a blog post may have an infinite number of comments. Like all other Active record  relationships, one-to-many relationships are defined by defining a method on your Active record model:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">Post</span> <span class="token operator">&lt;</span> ApplicationRecord
  has_many <span class="token symbol">:comments</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>The corresponding migration might look like this:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">CreatePosts</span> <span class="token operator">&lt;</span> ActiveRecord<span class="token double-colon punctuation">::</span>Migration<span class="token punctuation">[</span><span class="token number">7.0</span><span class="token punctuation">]</span>
  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">change</span></span>
    create_table <span class="token symbol">:posts</span> <span class="token keyword">do</span> <span class="token operator">|</span>t<span class="token operator">|</span>
      t<span class="token punctuation">.</span>string <span class="token symbol">:title</span>
      t<span class="token punctuation">.</span>timestamps
    <span class="token keyword">end</span>

    create_table <span class="token symbol">:comments</span> <span class="token keyword">do</span> <span class="token operator">|</span>t<span class="token operator">|</span>
      t<span class="token punctuation">.</span>belongs_to <span class="token symbol">:post</span>
      t<span class="token punctuation">.</span>datetime <span class="token symbol">:published_at</span>
      t<span class="token punctuation">.</span>timestamps
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>Depending on the use case, it's usually a good idea to create a non-unique index and optionally a foreign key constraint on the author column for the books table:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>create_table <span class="token symbol">:comments</span> <span class="token keyword">do</span> <span class="token operator">|</span>t<span class="token operator">|</span>
  t<span class="token punctuation">.</span>belongs_to <span class="token symbol">:post</span><span class="token punctuation">,</span> <span class="token symbol">index</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token symbol">foreign_key</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token comment"># ...</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>You can access the associated relation by</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>comments <span class="token operator">=</span> Post<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>comments
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>Has One Through</p> <p>A <code>[has_one :through](https://api.rubyonrails.org/v7.0.4/classes/ActiveRecord/Associations/ClassMethods.html#method-i-has_one)</code> association sets up a one-to-one connection with another model. This association indicates that the declaring model can be matched with one instance of another model by proceeding <em>through</em> a third model. For example, if each supplier has one account, and each account is associated with one account history, then the supplier model could look like this:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">Supplier</span> <span class="token operator">&lt;</span> ApplicationRecord
  has_one <span class="token symbol">:account</span>
  has_one <span class="token symbol">:account_history</span><span class="token punctuation">,</span> <span class="token symbol">through</span><span class="token operator">:</span> <span class="token symbol">:account</span>
<span class="token keyword">end</span>

<span class="token keyword">class</span> <span class="token class-name">Account</span> <span class="token operator">&lt;</span> ApplicationRecord
  belongs_to <span class="token symbol">:supplier</span>
  has_one <span class="token symbol">:account_history</span>
<span class="token keyword">end</span>

<span class="token keyword">class</span> <span class="token class-name">AccountHistory</span> <span class="token operator">&lt;</span> ApplicationRecord
  belongs_to <span class="token symbol">:account</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>The corresponding migration might look like this:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">CreateAccountHistories</span> <span class="token operator">&lt;</span> ActiveRecord<span class="token double-colon punctuation">::</span>Migration<span class="token punctuation">[</span><span class="token number">7.0</span><span class="token punctuation">]</span>
  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">change</span></span>
    create_table <span class="token symbol">:suppliers</span> <span class="token keyword">do</span> <span class="token operator">|</span>t<span class="token operator">|</span>
      t<span class="token punctuation">.</span>string <span class="token symbol">:name</span>
      t<span class="token punctuation">.</span>timestamps
    <span class="token keyword">end</span>

    create_table <span class="token symbol">:accounts</span> <span class="token keyword">do</span> <span class="token operator">|</span>t<span class="token operator">|</span>
      t<span class="token punctuation">.</span>belongs_to <span class="token symbol">:supplier</span>
      t<span class="token punctuation">.</span>string <span class="token symbol">:account_number</span>
      t<span class="token punctuation">.</span>timestamps
    <span class="token keyword">end</span>

    create_table <span class="token symbol">:account_histories</span> <span class="token keyword">do</span> <span class="token operator">|</span>t<span class="token operator">|</span>
      t<span class="token punctuation">.</span>belongs_to <span class="token symbol">:account</span>
      t<span class="token punctuation">.</span>integer <span class="token symbol">:credit_rating</span>
      t<span class="token punctuation">.</span>timestamps
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div></li></ul></li> <li><p>Many to Many</p> <ul><li><p>Has Many Through</p> <p>A <code>[has_many :through](https://api.rubyonrails.org/v7.0.4/classes/ActiveRecord/Associations/ClassMethods.html#method-i-has_many)</code> association is often used to set up a many-to-many connection with another model. This association indicates that the declaring model can be matched with zero or more instances of another model by proceeding <em>through</em> a third model. For example, consider a medical practice where patients make appointments to see physicians.  The relevant association declarations could look like this:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">Physician</span> <span class="token operator">&lt;</span> ApplicationRecord
  has_many <span class="token symbol">:appointments</span>
  has_many <span class="token symbol">:patients</span><span class="token punctuation">,</span> <span class="token symbol">through</span><span class="token operator">:</span> <span class="token symbol">:appointments</span>
<span class="token keyword">end</span>

<span class="token keyword">class</span> <span class="token class-name">Appointment</span> <span class="token operator">&lt;</span> ApplicationRecord
  belongs_to <span class="token symbol">:physician</span>
  belongs_to <span class="token symbol">:patient</span>
<span class="token keyword">end</span>

<span class="token keyword">class</span> <span class="token class-name">Patient</span> <span class="token operator">&lt;</span> ApplicationRecord
  has_many <span class="token symbol">:appointments</span>
  has_many <span class="token symbol">:physicians</span><span class="token punctuation">,</span> <span class="token symbol">through</span><span class="token operator">:</span> <span class="token symbol">:appointments</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>The corresponding migration might look like this:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">CreateAppointments</span> <span class="token operator">&lt;</span> ActiveRecord<span class="token double-colon punctuation">::</span>Migration<span class="token punctuation">[</span><span class="token number">7.0</span><span class="token punctuation">]</span>
  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">change</span></span>
    create_table <span class="token symbol">:physicians</span> <span class="token keyword">do</span> <span class="token operator">|</span>t<span class="token operator">|</span>
      t<span class="token punctuation">.</span>string <span class="token symbol">:name</span>
      t<span class="token punctuation">.</span>timestamps
    <span class="token keyword">end</span>

    create_table <span class="token symbol">:patients</span> <span class="token keyword">do</span> <span class="token operator">|</span>t<span class="token operator">|</span>
      t<span class="token punctuation">.</span>string <span class="token symbol">:name</span>
      t<span class="token punctuation">.</span>timestamps
    <span class="token keyword">end</span>

    create_table <span class="token symbol">:appointments</span> <span class="token keyword">do</span> <span class="token operator">|</span>t<span class="token operator">|</span>
      t<span class="token punctuation">.</span>belongs_to <span class="token symbol">:physician</span>
      t<span class="token punctuation">.</span>belongs_to <span class="token symbol">:patient</span>
      t<span class="token punctuation">.</span>datetime <span class="token symbol">:appointment_date</span>
      t<span class="token punctuation">.</span>timestamps
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>The collection of join models can be managed via the <code>[has_many</code> association methods](https://guides.rubyonrails.org/association_basics.html#has-many-association-reference)
. For example, if you assign:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>physician<span class="token punctuation">.</span>patients <span class="token operator">=</span> patients
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Then new join models are automatically created for the newly associated objects. If some that existed previously are now missing, then their join rows are automatically deleted.</p></li> <li><p>has and belongs to many</p> <p>A <code>[has_and_belongs_to_many](https://api.rubyonrails.org/v7.0.4/classes/ActiveRecord/Associations/ClassMethods.html#method-i-has_and_belongs_to_many)</code> association creates a direct many-to-many connection with another model, with no intervening model. This association indicates that each instance of the declaring model refers to zero or more instances of another model. For example, if your application includes assemblies and parts, with each assembly having many parts and each part appearing in many assemblies, you could declare the models this way:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">Assembly</span> <span class="token operator">&lt;</span> ApplicationRecord
  has_and_belongs_to_many <span class="token symbol">:parts</span>
<span class="token keyword">end</span>

<span class="token keyword">class</span> <span class="token class-name">Part</span> <span class="token operator">&lt;</span> ApplicationRecord
  has_and_belongs_to_many <span class="token symbol">:assemblies</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>The corresponding migration might look like this:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">CreateAssembliesAndParts</span> <span class="token operator">&lt;</span> ActiveRecord<span class="token double-colon punctuation">::</span>Migration<span class="token punctuation">[</span><span class="token number">7.0</span><span class="token punctuation">]</span>
  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">change</span></span>
    create_table <span class="token symbol">:assemblies</span> <span class="token keyword">do</span> <span class="token operator">|</span>t<span class="token operator">|</span>
      t<span class="token punctuation">.</span>string <span class="token symbol">:name</span>
      t<span class="token punctuation">.</span>timestamps
    <span class="token keyword">end</span>

    create_table <span class="token symbol">:parts</span> <span class="token keyword">do</span> <span class="token operator">|</span>t<span class="token operator">|</span>
      t<span class="token punctuation">.</span>string <span class="token symbol">:part_number</span>
      t<span class="token punctuation">.</span>timestamps
    <span class="token keyword">end</span>

    create_table <span class="token symbol">:assemblies_parts</span><span class="token punctuation">,</span> <span class="token symbol">id</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token keyword">do</span> <span class="token operator">|</span>t<span class="token operator">|</span>
      t<span class="token punctuation">.</span>belongs_to <span class="token symbol">:assembly</span>
      t<span class="token punctuation">.</span>belongs_to <span class="token symbol">:part</span>
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div></li></ul></li> <li><p>Polymorphic Relationships</p> <p>A slightly more advanced twist on associations is the <em>polymorphic association</em>. With polymorphic associations, a model can belong to more than one other model, on a single association. For example, you might have a picture model that belongs to either an employee model or a product model. Here's how this could be declared:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">Picture</span> <span class="token operator">&lt;</span> ApplicationRecord
  belongs_to <span class="token symbol">:imageable</span><span class="token punctuation">,</span> <span class="token symbol">polymorphic</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token keyword">end</span>

<span class="token keyword">class</span> <span class="token class-name">Employee</span> <span class="token operator">&lt;</span> ApplicationRecord
  has_many <span class="token symbol">:pictures</span><span class="token punctuation">,</span> <span class="token symbol">as</span><span class="token operator">:</span> <span class="token symbol">:imageable</span>
<span class="token keyword">end</span>

<span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token operator">&lt;</span> ApplicationRecord
  has_many <span class="token symbol">:pictures</span><span class="token punctuation">,</span> <span class="token symbol">as</span><span class="token operator">:</span> <span class="token symbol">:imageable</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>You can think of a polymorphic <code>belongs_to</code> declaration as setting up an interface that any other model can use. From an instance of the <code>Employee</code> model, you can retrieve a collection of pictures: <code>@employee.pictures</code>.</p> <p>Similarly, you can retrieve <code>@product.pictures</code>.</p> <p>If you have an instance of the <code>Picture</code> model, you can get to its parent via <code>@picture.imageable</code>. To make this work, you need to declare both a foreign key column and a type column in the model that declares the polymorphic interface:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">CreatePictures</span> <span class="token operator">&lt;</span> ActiveRecord<span class="token double-colon punctuation">::</span>Migration<span class="token punctuation">[</span><span class="token number">7.0</span><span class="token punctuation">]</span>
  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">change</span></span>
    create_table <span class="token symbol">:pictures</span> <span class="token keyword">do</span> <span class="token operator">|</span>t<span class="token operator">|</span>
      t<span class="token punctuation">.</span>string  <span class="token symbol">:name</span>
      t<span class="token punctuation">.</span>bigint  <span class="token symbol">:imageable_id</span>
      t<span class="token punctuation">.</span>string  <span class="token symbol">:imageable_type</span>
      t<span class="token punctuation">.</span>timestamps
    <span class="token keyword">end</span>

    add_index <span class="token symbol">:pictures</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token symbol">:imageable_type</span><span class="token punctuation">,</span> <span class="token symbol">:imageable_id</span><span class="token punctuation">]</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>This migration can be simplified by using the <code>t.references</code> form:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">CreatePictures</span> <span class="token operator">&lt;</span> ActiveRecord<span class="token double-colon punctuation">::</span>Migration<span class="token punctuation">[</span><span class="token number">7.0</span><span class="token punctuation">]</span>
  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">change</span></span>
    create_table <span class="token symbol">:pictures</span> <span class="token keyword">do</span> <span class="token operator">|</span>t<span class="token operator">|</span>
      t<span class="token punctuation">.</span>string <span class="token symbol">:name</span>
      t<span class="token punctuation">.</span>references <span class="token symbol">:imageable</span><span class="token punctuation">,</span> <span class="token symbol">polymorphic</span><span class="token operator">:</span> <span class="token boolean">true</span>
      t<span class="token punctuation">.</span>timestamps
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li> <li><p>Self Joins</p> <p>In designing a data model, you will sometimes find a model that should have a relation to itself. For example, you may want to store all employees in a single database model, but be able to trace relationships such as between manager and subordinates. This situation can be modeled with self-joining associations:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">Employee</span> <span class="token operator">&lt;</span> ApplicationRecord
  has_many <span class="token symbol">:subordinates</span><span class="token punctuation">,</span> <span class="token symbol">class_name</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">&quot;Employee&quot;</span></span><span class="token punctuation">,</span>
                          <span class="token symbol">foreign_key</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">&quot;manager_id&quot;</span></span>

  belongs_to <span class="token symbol">:manager</span><span class="token punctuation">,</span> <span class="token symbol">class_name</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">&quot;Employee&quot;</span></span><span class="token punctuation">,</span> <span class="token symbol">optional</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>With this setup, you can retrieve <code>@employee.subordinates</code> and <code>@employee.manager</code>.</p> <p>In your migrations/schema, you will add a references column to the model itself.</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">CreateEmployees</span> <span class="token operator">&lt;</span> ActiveRecord<span class="token double-colon punctuation">::</span>Migration<span class="token punctuation">[</span><span class="token number">7.0</span><span class="token punctuation">]</span>
  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">change</span></span>
    create_table <span class="token symbol">:employees</span> <span class="token keyword">do</span> <span class="token operator">|</span>t<span class="token operator">|</span>
      t<span class="token punctuation">.</span>references <span class="token symbol">:manager</span><span class="token punctuation">,</span> <span class="token symbol">foreign_key</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token symbol">to_table</span><span class="token operator">:</span> <span class="token symbol">:employees</span> <span class="token punctuation">}</span>
      t<span class="token punctuation">.</span>timestamps
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/database/Validation.html" class="prev">
        Validation
      </a></span> <span class="next"><a href="/database/Callbacks.html">
        Callbacks
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.7adc5413.js" defer></script><script src="/assets/js/2.72a95a92.js" defer></script><script src="/assets/js/17.842c0f28.js" defer></script>
  </body>
</html>
