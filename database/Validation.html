<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Validation |  Ruby on Rails Documentattion </title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="RoR Documentation for Beginners">
    
    <link rel="preload" href="/assets/css/0.styles.d6ad21ed.css" as="style"><link rel="preload" href="/assets/js/app.7adc5413.js" as="script"><link rel="preload" href="/assets/js/2.72a95a92.js" as="script"><link rel="preload" href="/assets/js/18.93bc7927.js" as="script"><link rel="prefetch" href="/assets/js/10.a520d8be.js"><link rel="prefetch" href="/assets/js/11.f290d03c.js"><link rel="prefetch" href="/assets/js/12.52c96c43.js"><link rel="prefetch" href="/assets/js/13.2df3af10.js"><link rel="prefetch" href="/assets/js/14.840b181d.js"><link rel="prefetch" href="/assets/js/15.71342207.js"><link rel="prefetch" href="/assets/js/16.9d4ff7c3.js"><link rel="prefetch" href="/assets/js/17.842c0f28.js"><link rel="prefetch" href="/assets/js/19.5935f0d0.js"><link rel="prefetch" href="/assets/js/20.cdf58d7d.js"><link rel="prefetch" href="/assets/js/21.3166d2bf.js"><link rel="prefetch" href="/assets/js/22.b1a0c7ae.js"><link rel="prefetch" href="/assets/js/23.df366c28.js"><link rel="prefetch" href="/assets/js/24.fc6d5a86.js"><link rel="prefetch" href="/assets/js/25.2115eb5e.js"><link rel="prefetch" href="/assets/js/26.a5569d65.js"><link rel="prefetch" href="/assets/js/27.214f9614.js"><link rel="prefetch" href="/assets/js/28.6263065f.js"><link rel="prefetch" href="/assets/js/29.0f98370e.js"><link rel="prefetch" href="/assets/js/3.447679a1.js"><link rel="prefetch" href="/assets/js/30.1182db89.js"><link rel="prefetch" href="/assets/js/31.38016aaf.js"><link rel="prefetch" href="/assets/js/32.626ffe2b.js"><link rel="prefetch" href="/assets/js/33.039db41a.js"><link rel="prefetch" href="/assets/js/34.76b65e88.js"><link rel="prefetch" href="/assets/js/35.1f504bd2.js"><link rel="prefetch" href="/assets/js/36.2089506c.js"><link rel="prefetch" href="/assets/js/37.54d694f8.js"><link rel="prefetch" href="/assets/js/38.8a179bd0.js"><link rel="prefetch" href="/assets/js/39.3159a702.js"><link rel="prefetch" href="/assets/js/4.fb941f04.js"><link rel="prefetch" href="/assets/js/40.3697d274.js"><link rel="prefetch" href="/assets/js/41.b554a771.js"><link rel="prefetch" href="/assets/js/42.45c82fe7.js"><link rel="prefetch" href="/assets/js/43.b54c5bed.js"><link rel="prefetch" href="/assets/js/44.fbcc36d7.js"><link rel="prefetch" href="/assets/js/5.384b96a2.js"><link rel="prefetch" href="/assets/js/6.d92e70ec.js"><link rel="prefetch" href="/assets/js/7.189f016f.js"><link rel="prefetch" href="/assets/js/8.f4a80106.js"><link rel="prefetch" href="/assets/js/9.1176b470.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d6ad21ed.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name"> Ruby on Rails Documentattion </span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">Ruby on rails</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Getting Started</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Architecture Concepts</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>The Basic</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Database</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/database/" aria-current="page" class="sidebar-link">Database</a></li><li><a href="/database/Configurations.html" class="sidebar-link">Configurations</a></li><li><a href="/database/Active Record ORM.html" class="sidebar-link">Active Record ORM</a></li><li><a href="/database/Active Record Migrations.html" class="sidebar-link">Active Record Migrations</a></li><li><a href="/database/Model.html" class="sidebar-link">Model</a></li><li><a href="/database/Validation.html" aria-current="page" class="active sidebar-link">Validation</a></li><li><a href="/database/Relationships.html" class="sidebar-link">Relationships</a></li><li><a href="/database/Callbacks.html" class="sidebar-link">Callbacks</a></li><li><a href="/database/Query Builder.html" class="sidebar-link">Query Builder</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Digging Deeper</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Security</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Testing</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Packages</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="validation"><a href="#validation" class="header-anchor">#</a> Validation</h1> <p>Active Record allows you to validate the state of a model before it gets written into the database. There are several methods that you can use to check your models and validate that an attribute value is not empty, is unique and not already in the database, follows a specific format, and many more.</p> <ul><li><p>Writing Validation Logic</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token operator">&lt;</span> ApplicationRecord
  validates <span class="token symbol">:name</span><span class="token punctuation">,</span> <span class="token symbol">presence</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>The key word <code>validates</code>precedes the attributes to be validated (separated by commas), and is succeeded by the <code>presence</code>validator, assigned the condition <code>true</code>. The <code>presence</code> validator  checks that the attribute is <strong>not</strong><code>nil</code> or an empty <code>string</code>.</p> <p>We will discuss about other validator latter.</p> <p>Before saving an Active Record object, Rails runs your validations. If these validations produce any errors, Rails does not save the object.</p> <p>You can also run these validations on your own. <code>[valid?](https://api.rubyonrails.org/v7.0.4/classes/ActiveRecord/Validations.html#method-i-valid-3F)</code> triggers your validations and returns true if no errors were found in the object, and false otherwise. As you saw above</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>irb<span class="token operator">&gt;</span> Person.create<span class="token punctuation">(</span>name: <span class="token string">&quot;John Doe&quot;</span><span class="token punctuation">)</span>.valid?
<span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean">true</span>
irb<span class="token operator">&gt;</span> Person.create<span class="token punctuation">(</span>name: nil<span class="token punctuation">)</span>.valid?
<span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean">false</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><code>[invalid?](https://api.rubyonrails.org/v7.0.4/classes/ActiveModel/Validations.html#method-i-invalid-3F)</code>is the inverse of <code>valid?</code>. It triggers your validations, returning true if any errors were found in the object, and false otherwise.</p></li> <li><p>Working With Error Messages</p> <p>The <code>[valid?](https://api.rubyonrails.org/v7.0.4/classes/ActiveRecord/Validations.html#method-i-valid-3F)</code> and <code>[invalid?](https://api.rubyonrails.org/v7.0.4/classes/ActiveModel/Validations.html#method-i-invalid-3F)</code> methods only provide a summary status on validity. However you can dig deeper into each individual error by using various methods from the  <code>[errors](https://api.rubyonrails.org/v7.0.4/classes/ActiveModel/Validations.html#method-i-errors)</code>  collection.</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token operator">&lt;</span> ApplicationRecord
  validates <span class="token symbol">:name</span><span class="token punctuation">,</span> <span class="token symbol">presence</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token symbol">length</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token symbol">minimum</span><span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code> 

irb<span class="token operator">&gt;</span> person <span class="token operator">=</span> Person.new<span class="token punctuation">(</span>name: <span class="token string">&quot;JD&quot;</span><span class="token punctuation">)</span>
irb<span class="token operator">&gt;</span> person.valid?
<span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean">false</span>
irb<span class="token operator">&gt;</span> person.errors<span class="token punctuation">[</span>:name<span class="token punctuation">]</span>
<span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token string">&quot;is too short (minimum is 3 characters)&quot;</span><span class="token punctuation">]</span>

<span class="token comment">#where </span>

irb<span class="token operator">&gt;</span> person.errors.where<span class="token punctuation">(</span>:name<span class="token punctuation">)</span>
<span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span> <span class="token punctuation">..</span>. <span class="token punctuation">]</span> <span class="token comment"># all errors for :name attribute</span>

irb<span class="token operator">&gt;</span> person.errors.where<span class="token punctuation">(</span>:name, :too_short<span class="token punctuation">)</span>
<span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span> <span class="token punctuation">..</span>. <span class="token punctuation">]</span> <span class="token comment"># :too_short errors for :name attribute</span>

<span class="token comment">#error object</span>

irb<span class="token operator">&gt;</span> error <span class="token operator">=</span> person.errors.where<span class="token punctuation">(</span>:name<span class="token punctuation">)</span>.last

irb<span class="token operator">&gt;</span> error.attribute
<span class="token operator">=</span><span class="token operator">&gt;</span> :name
irb<span class="token operator">&gt;</span> error.type
<span class="token operator">=</span><span class="token operator">&gt;</span> :too_short
irb<span class="token operator">&gt;</span> error.options<span class="token punctuation">[</span>:count<span class="token punctuation">]</span>
<span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">3</span>

irb<span class="token operator">&gt;</span> error.message
<span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;is too short (minimum is 3 characters)&quot;</span>
irb<span class="token operator">&gt;</span> error.full_message
<span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;Name is too short (minimum is 3 characters)&quot;</span>

<span class="token comment">#error size</span>
irb<span class="token operator">&gt;</span> person.errors.size
<span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div></li> <li><p>Skipping Validations</p> <p>The following methods skip validations, and will save the object to the database regardless of its validity. They should be used with caution.</p> <ul><li><code>decrement!</code></li> <li><code>decrement_counter</code></li> <li><code>increment!</code></li> <li><code>increment_counter</code></li> <li><code>insert</code></li> <li><code>insert!</code></li> <li><code>insert_all</code></li> <li><code>insert_all!</code></li> <li><code>toggle!</code></li> <li><code>touch</code></li> <li><code>touch_all</code></li> <li><code>update_all</code></li> <li><code>update_attribute</code></li> <li><code>update_column</code></li> <li><code>update_columns</code></li> <li><code>update_counters</code></li> <li><code>upsert</code></li> <li><code>upsert_all</code></li></ul> <p>Note that <code>save</code> also has the ability to skip validations if passed <code>validate: false</code> as an argument. This technique should be used with caution.</p> <ul><li><code>save(validate: false)</code></li></ul></li> <li><p>Available Validation Rule</p> <p><strong>presence:</strong>
This method simply checks that the specified attribute(s) are not empty. In the below example the validation is ensuring that the name, login and email attributes are not empty.</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token operator">&lt;</span> ApplicationRecord
  validates <span class="token symbol">:name</span><span class="token punctuation">,</span> <span class="token symbol">:login</span><span class="token punctuation">,</span> <span class="token symbol">:email</span><span class="token punctuation">,</span> <span class="token symbol">presence</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>length:</strong>
This method checks the length of the given attribute’s value. It provides several different constraints: minimum, maximum, is and in. See below for an example.</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token operator">&lt;</span> ApplicationRecord
  validates <span class="token symbol">:name</span><span class="token punctuation">,</span> <span class="token symbol">length</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token symbol">minimum</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span>
  validates <span class="token symbol">:bio</span><span class="token punctuation">,</span> <span class="token symbol">length</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token symbol">maximum</span><span class="token operator">:</span> <span class="token number">500</span> <span class="token punctuation">}</span>
  validates <span class="token symbol">:password</span><span class="token punctuation">,</span> <span class="token symbol">length</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token symbol">in</span><span class="token operator">:</span> <span class="token number">6.</span><span class="token number">.20</span> <span class="token punctuation">}</span>
  validates <span class="token symbol">:registration_number</span><span class="token punctuation">,</span> <span class="token symbol">length</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token symbol">is</span><span class="token operator">:</span> <span class="token number">6</span> <span class="token punctuation">}</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>uniqueness:</strong>
This method check that a given attribute’s value is unique. In the below example the validation will check that value entered for the email attribute is unique. This method also allows you to add scope to specify one or more attributes to use as a limit for the uniqueness.</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">Account</span> <span class="token operator">&lt;</span> ApplicationRecord
  validates <span class="token symbol">:email</span><span class="token punctuation">,</span> <span class="token symbol">uniqueness</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>The validation happens by performing an SQL query into the model's table, searching for an existing record with the same value in that attribute.</p> <p>There is a <code>:scope</code> option that you can use to specify one or more attributes that are used to limit the uniqueness check:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">Holiday</span> <span class="token operator">&lt;</span> ApplicationRecord
  validates <span class="token symbol">:name</span><span class="token punctuation">,</span> <span class="token symbol">uniqueness</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token symbol">scope</span><span class="token operator">:</span> <span class="token symbol">:year</span><span class="token punctuation">,</span>
    <span class="token symbol">message</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">&quot;should happen once per year&quot;</span></span> <span class="token punctuation">}</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Should you wish to create a database constraint to prevent possible violations of a uniqueness validation using the <code>:scope</code>option, you must create a unique index on both columns in your database.</p> <p>There is also a <code>:case_sensitive</code>option that you can use to define whether the uniqueness constraint will be case sensitive, case insensitive, or respects default database collation. This option defaults to respects default database collation.</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token operator">&lt;</span> ApplicationRecord
  validates <span class="token symbol">:name</span><span class="token punctuation">,</span> <span class="token symbol">uniqueness</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token symbol">case_sensitive</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>inclusion:</strong>
This method checks that the given attribute’s values are included in a given set. Below, the validation method is checking that the attribute size includes either small, medium or large.</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">Coffee</span> <span class="token operator">&lt;</span> ApplicationRecord
  validates <span class="token symbol">:size</span><span class="token punctuation">,</span> <span class="token symbol">inclusion</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token symbol">in</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">%w(small medium large)</span></span><span class="token punctuation">,</span>
    <span class="token symbol">message</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">&quot;%{value} is not a valid size&quot;</span></span> <span class="token punctuation">}</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Another useful way to utilize the inclusion validation method is to check for true/false values. See below for an example:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>validates <span class="token symbol">:boolen_field_name</span><span class="token punctuation">,</span>  <span class="token symbol">inclusion</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token symbol">in</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>exclusion:</strong></p> <p>This method checks that the given attribute’s values are NOT included in a given set. In the example below, the validation is checking that in the subdomain attribute, “www”, “us”, “ca” and “jp” are not included. If a user tried to set the subdomain’s attribute as any of those strings, they would receive an error.</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">Account</span> <span class="token operator">&lt;</span> ApplicationRecord
  validates <span class="token symbol">:subdomain</span><span class="token punctuation">,</span> <span class="token symbol">exclusion</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token symbol">in</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">%w(www us ca jp)</span></span><span class="token punctuation">,</span>
    <span class="token symbol">message</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">&quot;%{value} is reserved.&quot;</span></span> <span class="token punctuation">}</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>format:</strong></p> <p>This method checks that the given attribute’s values match a given regular expression, which is specified using the <code>:with</code> option. Below is an example.</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token operator">&lt;</span> ApplicationRecord
  validates <span class="token symbol">:legacy_code</span><span class="token punctuation">,</span> <span class="token symbol">format</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token symbol">with</span><span class="token operator">:</span> <span class="token regex-literal"><span class="token regex">/\A[a-zA-Z]+\z/</span></span><span class="token punctuation">,</span>
    <span class="token symbol">message</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">&quot;only allows letters&quot;</span></span> <span class="token punctuation">}</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>numericality:</strong></p> <p>****This method checks that the given attribute has only numeric values. If you’d like to further specify only integral numbers, you would then follow numericality with :only_integer: true. In the below example the validation is checking that the points attribute is a number (integer or float). The next validation is checking that the games_played attribute is specifically an integer number.</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">Player</span> <span class="token operator">&lt;</span> ApplicationRecord
  validates <span class="token symbol">:points</span><span class="token punctuation">,</span> <span class="token symbol">numericality</span><span class="token operator">:</span> <span class="token boolean">true</span>
  validates <span class="token symbol">:games_played</span><span class="token punctuation">,</span> <span class="token symbol">numericality</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token symbol">only_integer</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Besides <code>:only_integer</code>, this helper also accepts the following options to add constraints to acceptable values:</p> <ul><li><code>:greater_than</code> - Specifies the value must be greater than the supplied value. The default error message for this option is <em>&quot;must be greater than %{count}&quot;</em>.</li> <li><code>:greater_than_or_equal_to</code> - Specifies the value must be greater than or equal to the supplied value. The default error message for this option is <em>&quot;must be greater than or equal to %{count}&quot;</em>.</li> <li><code>:equal_to</code> - Specifies the value must be equal to the supplied value. The default error message for this option is <em>&quot;must be equal to %{count}&quot;</em>.</li> <li><code>:less_than</code> - Specifies the value must be less than the supplied value. The default error message for this option is <em>&quot;must be less than %{count}&quot;</em>.</li> <li><code>:less_than_or_equal_to</code> - Specifies the value must be less than or equal to the supplied value. The default error message for this option is <em>&quot;must be less than or equal to %{count}&quot;</em>.</li> <li><code>:other_than</code> - Specifies the value must be other than the supplied value. The default error message for this option is <em>&quot;must be other than %{count}&quot;</em>.</li> <li><code>:in</code> - Specifies the value must be in the supplied range. The default error message for this option is <em>&quot;must be in %{count}&quot;</em>.</li> <li><code>:odd</code> - Specifies the value must be an odd number if set to true. The default error message for this option is <em>&quot;must be odd&quot;</em>.</li> <li><code>:even</code> - Specifies the value must be an even number if set to true. The default error message for this option is <em>&quot;must be even&quot;</em>.</li></ul> <p>You can view all the validator options below</p> <p><a href="https://guides.rubyonrails.org/v5.1/active_record_validations.html" target="_blank" rel="noopener noreferrer">Active Record Validations - Ruby on Rails Guides<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p>Custom Validation Rule</p> <p><strong>Custom Validators</strong></p> <p>Custom validators are classes that inherit from <code>[ActiveModel::Validator](https://api.rubyonrails.org/v7.0.4/classes/ActiveModel/Validator.html)</code>. These classes must implement the <code>validate</code>method which takes a record as an argument and performs the validation on it. The custom validator is called using the <code>validates_with</code>method.</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">MyValidator</span> <span class="token operator">&lt;</span> ActiveModel<span class="token double-colon punctuation">::</span>Validator
  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">validate</span></span><span class="token punctuation">(</span>record<span class="token punctuation">)</span>
    <span class="token keyword">unless</span> record<span class="token punctuation">.</span>name<span class="token punctuation">.</span>start_with<span class="token operator">?</span> <span class="token string-literal"><span class="token string">'X'</span></span>
      record<span class="token punctuation">.</span>errors<span class="token punctuation">.</span>add <span class="token symbol">:name</span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">&quot;Need a name starting with X please!&quot;</span></span>
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token keyword">class</span> <span class="token class-name">Person</span>
  <span class="token keyword">include</span> ActiveModel<span class="token double-colon punctuation">::</span>Validations
  validates_with MyValidator
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>The easiest way to add custom validators for validating individual attributes is with the convenient <code>[ActiveModel::EachValidator](https://api.rubyonrails.org/v7.0.4/classes/ActiveModel/EachValidator.html)</code>. In this case, the custom validator class must implement a <code>validate_each</code>method which takes three arguments: record, attribute, and value. These correspond to the instance, the attribute to be validated, and the value of the attribute in the passed instance.</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">EmailValidator</span> <span class="token operator">&lt;</span> ActiveModel<span class="token double-colon punctuation">::</span>EachValidator
  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">validate_each</span></span><span class="token punctuation">(</span>record<span class="token punctuation">,</span> attribute<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
    <span class="token keyword">unless</span> value <span class="token operator">=~</span> <span class="token regex-literal"><span class="token regex">/\A([^@\s]+)@((?:[-a-z0-9]+\.)+[a-z]{2,})\z/i</span></span>
      record<span class="token punctuation">.</span>errors<span class="token punctuation">.</span>add attribute<span class="token punctuation">,</span> <span class="token punctuation">(</span>options<span class="token punctuation">[</span><span class="token symbol">:message</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token string-literal"><span class="token string">&quot;is not an email&quot;</span></span><span class="token punctuation">)</span>
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token operator">&lt;</span> ApplicationRecord
  validates <span class="token symbol">:email</span><span class="token punctuation">,</span> <span class="token symbol">presence</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token symbol">email</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>Custom Methods</strong></p> <p>You can also create methods that verify the state of your models and add errors to the <code>errors</code>collection when they are invalid. You must then register these methods by using the <code>[validate](https://api.rubyonrails.org/v7.0.4/classes/ActiveModel/Validations/ClassMethods.html#method-i-validate)</code> class method, passing in the symbols for the validation methods' names.</p> <p>You can pass more than one symbol for each class method and the respective validations will be run in the same order as they were registered.</p> <p>The <code>valid?</code> method will verify that the <code>errors</code> collection is empty, so your custom validation methods should add errors to it when you wish validation to fail:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">Invoice</span> <span class="token operator">&lt;</span> ApplicationRecord
  validate <span class="token symbol">:expiration_date_cannot_be_in_the_past</span><span class="token punctuation">,</span>
    <span class="token symbol">:discount_cannot_be_greater_than_total_value</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">expiration_date_cannot_be_in_the_past</span></span>
    <span class="token keyword">if</span> expiration_date<span class="token punctuation">.</span>present<span class="token operator">?</span> <span class="token operator">&amp;&amp;</span> expiration_date <span class="token operator">&lt;</span> Date<span class="token punctuation">.</span>today
      errors<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token symbol">:expiration_date</span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">&quot;can't be in the past&quot;</span></span><span class="token punctuation">)</span>
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">discount_cannot_be_greater_than_total_value</span></span>
    <span class="token keyword">if</span> discount <span class="token operator">&gt;</span> total_value
      errors<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token symbol">:discount</span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">&quot;can't be greater than total value&quot;</span></span><span class="token punctuation">)</span>
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>By default, such validations will run every time you call <code>valid?</code>or save the object. But it is also possible to control when to run these custom validations by giving an <code>:on</code>option to the <code>validate</code>method, with either: <code>:create</code>or <code>:update</code></p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">Invoice</span> <span class="token operator">&lt;</span> ApplicationRecord
  validate <span class="token symbol">:active_customer</span><span class="token punctuation">,</span> <span class="token symbol">on</span><span class="token operator">:</span> <span class="token symbol">:create</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">active_customer</span></span>
    errors<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token symbol">:customer_id</span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">&quot;is not active&quot;</span></span><span class="token punctuation">)</span> <span class="token keyword">unless</span> customer<span class="token punctuation">.</span>active<span class="token operator">?</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>Displaying Errors in frontend</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token keyword">if</span> <span class="token variable">@article</span><span class="token punctuation">.</span>errors<span class="token punctuation">.</span>any<span class="token operator">?</span> <span class="token string-literal"><span class="token string">%&gt;
  &lt;h3&gt;</span></span>The following errors prevented the article from being saved<span class="token operator">:</span><span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>ul<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token variable">@article</span><span class="token punctuation">.</span>errors<span class="token punctuation">.</span>full_messages<span class="token punctuation">.</span><span class="token keyword">each</span> <span class="token keyword">do</span> <span class="token operator">|</span>msg<span class="token operator">|</span> <span class="token string-literal"><span class="token string">%&gt;
     &lt;li&gt;</span></span><span class="token operator">&lt;</span><span class="token operator">%=</span> msg <span class="token string-literal"><span class="token string">%&gt;&lt;/li&gt;</span></span> 
    <span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token keyword">end</span> <span class="token string-literal"><span class="token string">%&gt;
  &lt;/ul&gt;</span></span>
<span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token keyword">end</span> <span class="token operator">%</span><span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>Displaying message using flash</strong></p> <p>Now, what if the new article is saved successfully? How could we tell the user this?</p> <p>Back in the <code>articles_controller.rb</code> file:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">def</span> <span class="token method-definition"><span class="token function">create</span></span>
    <span class="token variable">@article</span> <span class="token operator">=</span> <span class="token class-name">Article</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span><span class="token keyword">require</span><span class="token punctuation">(</span><span class="token symbol">:article</span><span class="token punctuation">)</span><span class="token punctuation">.</span>permit<span class="token punctuation">(</span><span class="token symbol">:title</span><span class="token punctuation">,</span> <span class="token symbol">:description</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token variable">@article</span><span class="token punctuation">.</span>save
      flash<span class="token punctuation">[</span><span class="token symbol">:notice</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;This article was saved successfully&quot;</span></span>
      redirect_to <span class="token variable">@article</span>
    <span class="token keyword">else</span> 
      render <span class="token string-literal"><span class="token string">'new'</span></span>
    <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>Above we say if the article is saved successfully to the database, we use <a href="https://api.rubyonrails.org/classes/ActionDispatch/Flash.html" target="_blank" rel="noopener noreferrer">flash<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to pass a temporary message from the <code>create</code> action to the <code>show</code> action. The <code>show</code> action will automatically pass the massage to its view. However, we can do something like this:</p> <p>In the <code>application.html.erb</code> file:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
   <span class="token operator">&lt;</span><span class="token operator">%</span> flash<span class="token punctuation">.</span><span class="token keyword">each</span> <span class="token keyword">do</span> <span class="token operator">|</span>name<span class="token punctuation">,</span> msg<span class="token operator">|</span> <span class="token string-literal"><span class="token string">%&gt;
     &lt;%= msg %&gt;</span></span>
   <span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token keyword">end</span> <span class="token string-literal"><span class="token string">%&gt;
   &lt;%= yield %&gt;</span></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/database/Model.html" class="prev">
        Model
      </a></span> <span class="next"><a href="/database/Relationships.html">
        Relationships
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.7adc5413.js" defer></script><script src="/assets/js/2.72a95a92.js" defer></script><script src="/assets/js/18.93bc7927.js" defer></script>
  </body>
</html>
