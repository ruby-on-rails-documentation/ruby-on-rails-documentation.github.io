<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Query Builder |  Ruby on Rails Documentattion </title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="RoR Documentation for Beginners">
    
    <link rel="preload" href="/assets/css/0.styles.d6ad21ed.css" as="style"><link rel="preload" href="/assets/js/app.7adc5413.js" as="script"><link rel="preload" href="/assets/js/2.72a95a92.js" as="script"><link rel="preload" href="/assets/js/15.71342207.js" as="script"><link rel="prefetch" href="/assets/js/10.a520d8be.js"><link rel="prefetch" href="/assets/js/11.f290d03c.js"><link rel="prefetch" href="/assets/js/12.52c96c43.js"><link rel="prefetch" href="/assets/js/13.2df3af10.js"><link rel="prefetch" href="/assets/js/14.840b181d.js"><link rel="prefetch" href="/assets/js/16.9d4ff7c3.js"><link rel="prefetch" href="/assets/js/17.842c0f28.js"><link rel="prefetch" href="/assets/js/18.93bc7927.js"><link rel="prefetch" href="/assets/js/19.5935f0d0.js"><link rel="prefetch" href="/assets/js/20.cdf58d7d.js"><link rel="prefetch" href="/assets/js/21.3166d2bf.js"><link rel="prefetch" href="/assets/js/22.b1a0c7ae.js"><link rel="prefetch" href="/assets/js/23.df366c28.js"><link rel="prefetch" href="/assets/js/24.fc6d5a86.js"><link rel="prefetch" href="/assets/js/25.2115eb5e.js"><link rel="prefetch" href="/assets/js/26.a5569d65.js"><link rel="prefetch" href="/assets/js/27.214f9614.js"><link rel="prefetch" href="/assets/js/28.6263065f.js"><link rel="prefetch" href="/assets/js/29.0f98370e.js"><link rel="prefetch" href="/assets/js/3.447679a1.js"><link rel="prefetch" href="/assets/js/30.1182db89.js"><link rel="prefetch" href="/assets/js/31.38016aaf.js"><link rel="prefetch" href="/assets/js/32.626ffe2b.js"><link rel="prefetch" href="/assets/js/33.039db41a.js"><link rel="prefetch" href="/assets/js/34.76b65e88.js"><link rel="prefetch" href="/assets/js/35.1f504bd2.js"><link rel="prefetch" href="/assets/js/36.2089506c.js"><link rel="prefetch" href="/assets/js/37.54d694f8.js"><link rel="prefetch" href="/assets/js/38.8a179bd0.js"><link rel="prefetch" href="/assets/js/39.3159a702.js"><link rel="prefetch" href="/assets/js/4.fb941f04.js"><link rel="prefetch" href="/assets/js/40.3697d274.js"><link rel="prefetch" href="/assets/js/41.b554a771.js"><link rel="prefetch" href="/assets/js/42.45c82fe7.js"><link rel="prefetch" href="/assets/js/43.b54c5bed.js"><link rel="prefetch" href="/assets/js/44.fbcc36d7.js"><link rel="prefetch" href="/assets/js/5.384b96a2.js"><link rel="prefetch" href="/assets/js/6.d92e70ec.js"><link rel="prefetch" href="/assets/js/7.189f016f.js"><link rel="prefetch" href="/assets/js/8.f4a80106.js"><link rel="prefetch" href="/assets/js/9.1176b470.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d6ad21ed.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name"> Ruby on Rails Documentattion </span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">Ruby on rails</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Getting Started</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Architecture Concepts</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>The Basic</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Database</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/database/" aria-current="page" class="sidebar-link">Database</a></li><li><a href="/database/Configurations.html" class="sidebar-link">Configurations</a></li><li><a href="/database/Active Record ORM.html" class="sidebar-link">Active Record ORM</a></li><li><a href="/database/Active Record Migrations.html" class="sidebar-link">Active Record Migrations</a></li><li><a href="/database/Model.html" class="sidebar-link">Model</a></li><li><a href="/database/Validation.html" class="sidebar-link">Validation</a></li><li><a href="/database/Relationships.html" class="sidebar-link">Relationships</a></li><li><a href="/database/Callbacks.html" class="sidebar-link">Callbacks</a></li><li><a href="/database/Query Builder.html" class="active sidebar-link">Query Builder</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Digging Deeper</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Security</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Testing</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Packages</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="query-builder"><a href="#query-builder" class="header-anchor">#</a> Query Builder</h1> <ul><li><p>Retrieving a Single Object</p> <p><strong>find()</strong></p> <p>The find method retrieve the object corresponding to the specified <em>primary key</em>
 that matches any supplied options</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>customer <span class="token operator">=</span> Customer<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token comment">#&lt;Customer id: 10, first_name: &quot;Ryan&quot;&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>take()</strong></p> <p>The take method retrieves a record without any implicit ordering.</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>customer <span class="token operator">=</span> Customer<span class="token punctuation">.</span>take
<span class="token comment">#&lt;Customer id: 1, first_name: &quot;Lifo&quot;&gt;</span>

customers <span class="token operator">=</span> Customer<span class="token punctuation">.</span>take<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token comment">#&lt;Customer id: 1, first_name: &quot;Lifo&quot;&gt;, #&lt;Customer id: 220, first_name: &quot;Sara&quot;&gt;]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>first()</strong></p> <p>The first method finds the first record ordered by primary key (default).</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>customer <span class="token operator">=</span> Customer<span class="token punctuation">.</span>first
<span class="token comment">#&lt;Customer id: 1, first_name: &quot;Lifo&quot;&gt;</span>

customers <span class="token operator">=</span> Customer<span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token comment">#&lt;Customer id: 1, first_name: &quot;Lifo&quot;&gt;, #&lt;Customer id: 2, first_name: &quot;Fifo&quot;&gt;, #&lt;Customer id: 3, first_name: &quot;Filo&quot;&gt;]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>last()</strong></p> <p>The last method finds the last record ordered by primary key (default).</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>customer <span class="token operator">=</span> Customer<span class="token punctuation">.</span>last
<span class="token comment">#&lt;Customer id: 221, first_name: &quot;Russel&quot;&gt;</span>

customers <span class="token operator">=</span> Customer<span class="token punctuation">.</span>last<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token comment">#&lt;Customer id: 219, first_name: &quot;James&quot;&gt;, #&lt;Customer id: 220, first_name: &quot;Sara&quot;&gt;, #&lt;Customer id: 221, first_name: &quot;Russel&quot;&gt;]</span>

customer <span class="token operator">=</span> Customer<span class="token punctuation">.</span>order<span class="token punctuation">(</span><span class="token symbol">:first_name</span><span class="token punctuation">)</span><span class="token punctuation">.</span>last
<span class="token comment">#&lt;Customer id: 220, first_name: &quot;Sara&quot;&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>find_by()</strong></p> <p>The find_by method finds the first record matching some conditions.</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>Customer<span class="token punctuation">.</span>find_by first_name<span class="token operator">:</span> <span class="token string-literal"><span class="token string">'Lifo'</span></span>
<span class="token comment">#&lt;Customer id: 1, first_name: &quot;Lifo&quot;&gt;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>Retrieving Multiple Objects in Batches</p> <p><strong>find_each()</strong></p> <p>The find_each method retrieves records in batches and then yields <em>each</em>
 one to the block.</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>Customer<span class="token punctuation">.</span>find_each <span class="token keyword">do</span> <span class="token operator">|</span>customer<span class="token operator">|</span>
  NewsMailer<span class="token punctuation">.</span>weekly<span class="token punctuation">(</span>customer<span class="token punctuation">)</span><span class="token punctuation">.</span>deliver_now
<span class="token keyword">end</span>

Customer<span class="token punctuation">.</span>where<span class="token punctuation">(</span><span class="token symbol">weekly_subscriber</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span>find_each <span class="token keyword">do</span> <span class="token operator">|</span>customer<span class="token operator">|</span>
  NewsMailer<span class="token punctuation">.</span>weekly<span class="token punctuation">(</span>customer<span class="token punctuation">)</span><span class="token punctuation">.</span>deliver_now
<span class="token keyword">end</span>

<span class="token comment">#batch size option allows you to specify the number of records to be retrieved in each batch</span>
Customer<span class="token punctuation">.</span>find_each<span class="token punctuation">(</span><span class="token symbol">batch_size</span><span class="token operator">:</span> <span class="token number">5000</span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token operator">|</span>customer<span class="token operator">|</span>
  NewsMailer<span class="token punctuation">.</span>weekly<span class="token punctuation">(</span>customer<span class="token punctuation">)</span><span class="token punctuation">.</span>deliver_now
<span class="token keyword">end</span>

<span class="token comment">#start option allows you to configure the first ID of the sequence whenever the lowest ID is not the one you need.</span>

Customer<span class="token punctuation">.</span>find_each<span class="token punctuation">(</span><span class="token symbol">start</span><span class="token operator">:</span> <span class="token number">2000</span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token operator">|</span>customer<span class="token operator">|</span>
  NewsMailer<span class="token punctuation">.</span>weekly<span class="token punctuation">(</span>customer<span class="token punctuation">)</span><span class="token punctuation">.</span>deliver_now
<span class="token keyword">end</span>

<span class="token comment">#finish allows you to configure the last ID of the sequence whenever the highest ID is not the one you need.</span>

Customer<span class="token punctuation">.</span>find_each<span class="token punctuation">(</span><span class="token symbol">start</span><span class="token operator">:</span> <span class="token number">2000</span><span class="token punctuation">,</span> <span class="token symbol">finish</span><span class="token operator">:</span> <span class="token number">10000</span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token operator">|</span>customer<span class="token operator">|</span>
  NewsMailer<span class="token punctuation">.</span>weekly<span class="token punctuation">(</span>customer<span class="token punctuation">)</span><span class="token punctuation">.</span>deliver_now
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p><strong>find_in_batches()</strong></p> <p>The find_in_batches method is similar to <code>find_each</code>, since both retrieve batches of records. The difference is that <code>find_in_batches</code>yields <em>batches</em> to the block as an array of models, instead of individually.</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token comment"># Give add_customers an array of 1000 customers at a time.</span>
Customer<span class="token punctuation">.</span>find_in_batches <span class="token keyword">do</span> <span class="token operator">|</span>customers<span class="token operator">|</span>
  export<span class="token punctuation">.</span>add_customers<span class="token punctuation">(</span>customers<span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token comment"># Give add_customers an array of 1000 recently active customers at a time.</span>
Customer<span class="token punctuation">.</span>recently_active<span class="token punctuation">.</span>find_in_batches <span class="token keyword">do</span> <span class="token operator">|</span>customers<span class="token operator">|</span>
  export<span class="token punctuation">.</span>add_customers<span class="token punctuation">(</span>customers<span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token comment">#batch_size</span>
Customer<span class="token punctuation">.</span>find_in_batches<span class="token punctuation">(</span><span class="token symbol">batch_size</span><span class="token operator">:</span> <span class="token number">2500</span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token operator">|</span>customers<span class="token operator">|</span>
  export<span class="token punctuation">.</span>add_customers<span class="token punctuation">(</span>customers<span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token comment">#start</span>
Customer<span class="token punctuation">.</span>find_in_batches<span class="token punctuation">(</span><span class="token symbol">batch_size</span><span class="token operator">:</span> <span class="token number">2500</span><span class="token punctuation">,</span> <span class="token symbol">start</span><span class="token operator">:</span> <span class="token number">5000</span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token operator">|</span>customers<span class="token operator">|</span>
  export<span class="token punctuation">.</span>add_customers<span class="token punctuation">(</span>customers<span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token comment">#finish</span>
Customer<span class="token punctuation">.</span>find_in_batches<span class="token punctuation">(</span><span class="token symbol">finish</span><span class="token operator">:</span> <span class="token number">7000</span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token operator">|</span>customers<span class="token operator">|</span>
  export<span class="token punctuation">.</span>add_customers<span class="token punctuation">(</span>customers<span class="token punctuation">)</span>
<span class="token keyword">end</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div></li> <li><p>Conditions</p> <p>The <code>[where](https://api.rubyonrails.org/v7.0.4/classes/ActiveRecord/QueryMethods.html#method-i-where)</code> method allows you to specify conditions to limit the records returned, representing the <code>WHERE</code>-part of the SQL statement. Conditions can either be specified as a string, array, or hash.</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token comment">#Pure String Conditions</span>
Book<span class="token punctuation">.</span>where<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;title = 'Introduction to Algorithms'&quot;</span></span><span class="token punctuation">)</span>

<span class="token comment">#Array Conditions</span>
Book<span class="token punctuation">.</span>where<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;title = ?&quot;</span></span><span class="token punctuation">,</span> params<span class="token punctuation">[</span><span class="token symbol">:title</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

Book<span class="token punctuation">.</span>where<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;title = ? AND out_of_print = ?&quot;</span></span><span class="token punctuation">,</span> params<span class="token punctuation">[</span><span class="token symbol">:title</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>

Book<span class="token punctuation">.</span>where<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;title LIKE ?&quot;</span></span><span class="token punctuation">,</span>
  Book<span class="token punctuation">.</span>sanitize_sql_like<span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token symbol">:title</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string-literal"><span class="token string">&quot;%&quot;</span></span><span class="token punctuation">)</span>

<span class="token comment">#Hash Conditions</span>
Book<span class="token punctuation">.</span>where<span class="token punctuation">(</span><span class="token symbol">out_of_print</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span>

Book<span class="token punctuation">.</span>where<span class="token punctuation">(</span><span class="token symbol">created_at</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token builtin">Time</span><span class="token punctuation">.</span>now<span class="token punctuation">.</span>midnight <span class="token operator">-</span> <span class="token number">1.</span>day<span class="token punctuation">)</span><span class="token operator">..</span><span class="token builtin">Time</span><span class="token punctuation">.</span>now<span class="token punctuation">.</span>midnight<span class="token punctuation">)</span>

Customer<span class="token punctuation">.</span>where<span class="token punctuation">(</span><span class="token symbol">orders_count</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">#NOT Condition</span>
Customer<span class="token punctuation">.</span>where<span class="token punctuation">.</span><span class="token keyword">not</span><span class="token punctuation">(</span><span class="token symbol">orders_count</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">#OR Condition</span>
Customer<span class="token punctuation">.</span>where<span class="token punctuation">(</span><span class="token symbol">last_name</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">'Smith'</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">or</span><span class="token punctuation">(</span>Customer<span class="token punctuation">.</span>where<span class="token punctuation">(</span><span class="token symbol">orders_count</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">#AND Condition</span>
Customer<span class="token punctuation">.</span>where<span class="token punctuation">(</span><span class="token symbol">last_name</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">'Smith'</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span><span class="token symbol">orders_count</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div></li> <li><p>Ordering</p> <p>To retrieve records from the database in a specific order, you can use the <code>[order](https://api.rubyonrails.org/v7.0.4/classes/ActiveRecord/QueryMethods.html#method-i-order)</code> method.</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>Book<span class="token punctuation">.</span>order<span class="token punctuation">(</span><span class="token symbol">:created_at</span><span class="token punctuation">)</span>
<span class="token comment"># OR</span>
Book<span class="token punctuation">.</span>order<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;created_at&quot;</span></span><span class="token punctuation">)</span>

Book<span class="token punctuation">.</span>order<span class="token punctuation">(</span><span class="token symbol">created_at</span><span class="token operator">:</span> <span class="token symbol">:desc</span><span class="token punctuation">)</span>
<span class="token comment"># OR</span>
Book<span class="token punctuation">.</span>order<span class="token punctuation">(</span><span class="token symbol">created_at</span><span class="token operator">:</span> <span class="token symbol">:asc</span><span class="token punctuation">)</span>
<span class="token comment"># OR</span>
Book<span class="token punctuation">.</span>order<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;created_at DESC&quot;</span></span><span class="token punctuation">)</span>
<span class="token comment"># OR</span>
Book<span class="token punctuation">.</span>order<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;created_at ASC&quot;</span></span><span class="token punctuation">)</span>

Book<span class="token punctuation">.</span>order<span class="token punctuation">(</span><span class="token symbol">title</span><span class="token operator">:</span> <span class="token symbol">:asc</span><span class="token punctuation">,</span> <span class="token symbol">created_at</span><span class="token operator">:</span> <span class="token symbol">:desc</span><span class="token punctuation">)</span>
<span class="token comment"># OR</span>
Book<span class="token punctuation">.</span>order<span class="token punctuation">(</span><span class="token symbol">:title</span><span class="token punctuation">,</span> <span class="token symbol">created_at</span><span class="token operator">:</span> <span class="token symbol">:desc</span><span class="token punctuation">)</span>
<span class="token comment"># OR</span>
Book<span class="token punctuation">.</span>order<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;title ASC, created_at DESC&quot;</span></span><span class="token punctuation">)</span>
<span class="token comment"># OR</span>
Book<span class="token punctuation">.</span>order<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;title ASC&quot;</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">&quot;created_at DESC&quot;</span></span><span class="token punctuation">)</span>

Book<span class="token punctuation">.</span>order<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;title ASC&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span>order<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;created_at DESC&quot;</span></span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div></li> <li><p>Select Statement</p> <p>You may not always want to select all columns from a database table. Using the <strong><code>select</code></strong>
 method, you can specify a custom &quot;select&quot; clause for the query:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>Book<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token symbol">:isbn</span><span class="token punctuation">,</span> <span class="token symbol">:out_of_print</span><span class="token punctuation">)</span>
<span class="token comment"># OR</span>
Book<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;isbn, out_of_print&quot;</span></span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>If you would like to only grab a single record per unique value in a certain field, you can use <code>[distinct](https://api.rubyonrails.org/v7.0.4/classes/ActiveRecord/QueryMethods.html#method-i-distinct)</code>:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>Customer<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token symbol">:last_name</span><span class="token punctuation">)</span><span class="token punctuation">.</span>distinct
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>Limit and Offset</p> <p>You can use <code>limit</code>to specify the number of records to be retrieved, and use <code>offset</code>
 to specify the number of records to skip before starting to return the records. For example</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>Customer<span class="token punctuation">.</span>limit<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Adding <code>offset</code> to that</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>Customer<span class="token punctuation">.</span>limit<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>offset<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>Group</p> <p>To apply a <code>GROUP BY</code> clause to the SQL fired by the finder, you can use the <code>[group](https://api.rubyonrails.org/v7.0.4/classes/ActiveRecord/QueryMethods.html#method-i-group)</code> method.</p> <p>For example, if you want to find a collection of the dates on which orders were created:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>Order<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;created_at&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;created_at&quot;</span></span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>To get the total of grouped items on a single query, call <code>[count](https://api.rubyonrails.org/v7.0.4/classes/ActiveRecord/Calculations.html#method-i-count)</code> after the <code>group</code>.</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>irb<span class="token operator">&gt;</span> Order<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token symbol">:status</span><span class="token punctuation">)</span><span class="token punctuation">.</span>count
<span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token string-literal"><span class="token string">&quot;being_packed&quot;</span></span><span class="token operator">=&gt;</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">&quot;shipped&quot;</span></span><span class="token operator">=&gt;</span><span class="token number">12</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>Having</p> <p>SQL uses the <code>HAVING</code> clause to specify conditions on the <code>GROUP BY</code> fields. You can add the <code>HAVING</code> clause to the SQL fired by the <code>Model.find</code> by adding the <code>[having](https://api.rubyonrails.org/v7.0.4/classes/ActiveRecord/QueryMethods.html#method-i-having)</code> method to the find.</p> <p>For example:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>Order<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;created_at, sum(total) as total_price&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span>
  group<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;created_at&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span>having<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;sum(total) &gt; ?&quot;</span></span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>Joining Table</p> <p>Active Record provides two finder methods for specifying <code>JOIN</code> clauses on the resulting SQL: <code>joins</code>and <code>left_outer_joins</code>. While <code>joins</code>should be used for <code>INNER JOIN</code>or custom queries, <code>left_outer_joins</code> is used for queries using <code>LEFT OUTER JOIN</code></p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token comment">#Using String</span>
Author<span class="token punctuation">.</span>joins<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;INNER JOIN books ON books.author_id = authors.id AND books.out_of_print = FALSE&quot;</span></span><span class="token punctuation">)</span>

<span class="token comment">#Using Array/Hash of Named Associations</span>
Book<span class="token punctuation">.</span>joins<span class="token punctuation">(</span><span class="token symbol">:reviews</span><span class="token punctuation">)</span>

<span class="token comment">#Using Multiple Association</span>
Book<span class="token punctuation">.</span>joins<span class="token punctuation">(</span><span class="token symbol">:author</span><span class="token punctuation">,</span> <span class="token symbol">:reviews</span><span class="token punctuation">)</span>

<span class="token comment">#Joining Nested Associations (Single Level)</span>
Book<span class="token punctuation">.</span>joins<span class="token punctuation">(</span><span class="token symbol">reviews</span><span class="token operator">:</span> <span class="token symbol">:customer</span><span class="token punctuation">)</span>

<span class="token comment">#Joining Nested Associations (Multiple Level)</span>

Author<span class="token punctuation">.</span>joins<span class="token punctuation">(</span><span class="token symbol">books</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token symbol">reviews</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token symbol">customer</span><span class="token operator">:</span> <span class="token symbol">:orders</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token symbol">:supplier</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>

<span class="token comment">#Specifying Conditions on the Joined Tables</span>
time_range <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">Time</span><span class="token punctuation">.</span>now<span class="token punctuation">.</span>midnight <span class="token operator">-</span> <span class="token number">1.</span>day<span class="token punctuation">)</span><span class="token operator">..</span><span class="token builtin">Time</span><span class="token punctuation">.</span>now<span class="token punctuation">.</span>midnight
Customer<span class="token punctuation">.</span>joins<span class="token punctuation">(</span><span class="token symbol">:orders</span><span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'orders.created_at'</span></span> <span class="token operator">=&gt;</span> time_range<span class="token punctuation">)</span><span class="token punctuation">.</span>distinct

<span class="token comment">#or</span>

time_range <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">Time</span><span class="token punctuation">.</span>now<span class="token punctuation">.</span>midnight <span class="token operator">-</span> <span class="token number">1.</span>day<span class="token punctuation">)</span><span class="token operator">..</span><span class="token builtin">Time</span><span class="token punctuation">.</span>now<span class="token punctuation">.</span>midnight
Customer<span class="token punctuation">.</span>joins<span class="token punctuation">(</span><span class="token symbol">:orders</span><span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span><span class="token symbol">orders</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token symbol">created_at</span><span class="token operator">:</span> time_range <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>distinct

<span class="token comment">#left joins</span>
Customer<span class="token punctuation">.</span>left_outer_joins<span class="token punctuation">(</span><span class="token symbol">:reviews</span><span class="token punctuation">)</span><span class="token punctuation">.</span>distinct<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'customers.*, COUNT(reviews.*) AS reviews_count'</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'customers.id'</span></span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>.</p></li> <li><p>Eager Loading Relations</p> <p><strong>preload</strong></p> <p>Preload loads the association data in a separate query.
``</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>User<span class="token punctuation">.</span>preload<span class="token punctuation">(</span><span class="token symbol">:posts</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to_a

<span class="token comment"># =&gt;</span>
<span class="token constant">SELECT</span> <span class="token string-literal"><span class="token string">&quot;users&quot;</span></span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token constant">FROM</span> <span class="token string-literal"><span class="token string">&quot;users&quot;</span></span>
<span class="token constant">SELECT</span> <span class="token string-literal"><span class="token string">&quot;posts&quot;</span></span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token constant">FROM</span> <span class="token string-literal"><span class="token string">&quot;posts&quot;</span></span>  <span class="token constant">WHERE</span> <span class="token string-literal"><span class="token string">&quot;posts&quot;</span></span><span class="token punctuation">.</span><span class="token string-literal"><span class="token string">&quot;user_id&quot;</span></span> <span class="token constant">IN</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>This is how <strong>includes</strong> loads data in the default case.</p> <p>Since <strong>preload</strong> always generates two sql we can't use <strong>posts</strong> table in where condition. Following query will result in an error.</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>User<span class="token punctuation">.</span>preload<span class="token punctuation">(</span><span class="token symbol">:posts</span><span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;posts.desc='ruby is awesome'&quot;</span></span><span class="token punctuation">)</span>

<span class="token comment"># =&gt;</span>
SQLite3<span class="token double-colon punctuation">::</span>SQLException<span class="token operator">:</span> no such column<span class="token operator">:</span> posts<span class="token punctuation">.</span>desc<span class="token operator">:</span>
<span class="token constant">SELECT</span> <span class="token string-literal"><span class="token string">&quot;users&quot;</span></span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token constant">FROM</span> <span class="token string-literal"><span class="token string">&quot;users&quot;</span></span>  <span class="token constant">WHERE</span> <span class="token punctuation">(</span>posts<span class="token punctuation">.</span>desc<span class="token operator">=</span><span class="token string-literal"><span class="token string">'ruby is awesome'</span></span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>With preload where clauses can be applied.</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>User<span class="token punctuation">.</span>preload<span class="token punctuation">(</span><span class="token symbol">:posts</span><span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;users.name='Neeraj'&quot;</span></span><span class="token punctuation">)</span>

<span class="token comment"># =&gt;</span>
<span class="token constant">SELECT</span> <span class="token string-literal"><span class="token string">&quot;users&quot;</span></span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token constant">FROM</span> <span class="token string-literal"><span class="token string">&quot;users&quot;</span></span>  <span class="token constant">WHERE</span> <span class="token punctuation">(</span>users<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string-literal"><span class="token string">'Neeraj'</span></span><span class="token punctuation">)</span>
<span class="token constant">SELECT</span> <span class="token string-literal"><span class="token string">&quot;posts&quot;</span></span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token constant">FROM</span> <span class="token string-literal"><span class="token string">&quot;posts&quot;</span></span>  <span class="token constant">WHERE</span> <span class="token string-literal"><span class="token string">&quot;posts&quot;</span></span><span class="token punctuation">.</span><span class="token string-literal"><span class="token string">&quot;user_id&quot;</span></span> <span class="token constant">IN</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>includes</strong></p> <p>Includes loads the association data in a separate query just like <strong>preload</strong>.</p> <p>However it is smarter than <strong>preload</strong>. Above we saw that <strong>preload</strong> failed for query <strong>User.preload(:posts).where(&quot;posts.desc='ruby is awesome'&quot;)</strong>. Let's try same with includes.</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>User<span class="token punctuation">.</span>includes<span class="token punctuation">(</span><span class="token symbol">:posts</span><span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'posts.desc = &quot;ruby is awesome&quot;'</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span>to_a

<span class="token comment"># =&gt;</span>
<span class="token constant">SELECT</span> <span class="token string-literal"><span class="token string">&quot;users&quot;</span></span><span class="token punctuation">.</span><span class="token string-literal"><span class="token string">&quot;id&quot;</span></span> <span class="token constant">AS</span> t0_r0<span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">&quot;users&quot;</span></span><span class="token punctuation">.</span><span class="token string-literal"><span class="token string">&quot;name&quot;</span></span> <span class="token constant">AS</span> t0_r1<span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">&quot;posts&quot;</span></span><span class="token punctuation">.</span><span class="token string-literal"><span class="token string">&quot;id&quot;</span></span> <span class="token constant">AS</span> t1_r0<span class="token punctuation">,</span>
       <span class="token string-literal"><span class="token string">&quot;posts&quot;</span></span><span class="token punctuation">.</span><span class="token string-literal"><span class="token string">&quot;title&quot;</span></span> <span class="token constant">AS</span> t1_r1<span class="token punctuation">,</span>
       <span class="token string-literal"><span class="token string">&quot;posts&quot;</span></span><span class="token punctuation">.</span><span class="token string-literal"><span class="token string">&quot;user_id&quot;</span></span> <span class="token constant">AS</span> t1_r2<span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">&quot;posts&quot;</span></span><span class="token punctuation">.</span><span class="token string-literal"><span class="token string">&quot;desc&quot;</span></span> <span class="token constant">AS</span> t1_r3
<span class="token constant">FROM</span> <span class="token string-literal"><span class="token string">&quot;users&quot;</span></span> <span class="token constant">LEFT</span> <span class="token constant">OUTER</span> <span class="token constant">JOIN</span> <span class="token string-literal"><span class="token string">&quot;posts&quot;</span></span> <span class="token constant">ON</span> <span class="token string-literal"><span class="token string">&quot;posts&quot;</span></span><span class="token punctuation">.</span><span class="token string-literal"><span class="token string">&quot;user_id&quot;</span></span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;users&quot;</span></span><span class="token punctuation">.</span><span class="token string-literal"><span class="token string">&quot;id&quot;</span></span>
<span class="token constant">WHERE</span> <span class="token punctuation">(</span>posts<span class="token punctuation">.</span>desc <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;ruby is awesome&quot;</span></span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>As you can see <strong>includes</strong> switches from using two separate queries to creating a single <strong>LEFT OUTER JOIN</strong> to get the data. And it also applied the supplied condition.</p> <p>So <strong>includes</strong> changes from two queries to a single query in some cases. By default for a simple case it will use two queries. Let's say that for some reason you want to force a simple <strong>includes</strong>case to use a single query instead of two. Use <strong>references</strong> to achieve that.</p> <p><strong>eager_load</strong></p> <p>eager loading loads all association in a single query using <strong>LEFT OUTER JOIN</strong>
.</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>User<span class="token punctuation">.</span>eager_load<span class="token punctuation">(</span><span class="token symbol">:posts</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to_a

<span class="token comment"># =&gt;</span>
<span class="token constant">SELECT</span> <span class="token string-literal"><span class="token string">&quot;users&quot;</span></span><span class="token punctuation">.</span><span class="token string-literal"><span class="token string">&quot;id&quot;</span></span> <span class="token constant">AS</span> t0_r0<span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">&quot;users&quot;</span></span><span class="token punctuation">.</span><span class="token string-literal"><span class="token string">&quot;name&quot;</span></span> <span class="token constant">AS</span> t0_r1<span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">&quot;posts&quot;</span></span><span class="token punctuation">.</span><span class="token string-literal"><span class="token string">&quot;id&quot;</span></span> <span class="token constant">AS</span> t1_r0<span class="token punctuation">,</span>
       <span class="token string-literal"><span class="token string">&quot;posts&quot;</span></span><span class="token punctuation">.</span><span class="token string-literal"><span class="token string">&quot;title&quot;</span></span> <span class="token constant">AS</span> t1_r1<span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">&quot;posts&quot;</span></span><span class="token punctuation">.</span><span class="token string-literal"><span class="token string">&quot;user_id&quot;</span></span> <span class="token constant">AS</span> t1_r2<span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">&quot;posts&quot;</span></span><span class="token punctuation">.</span><span class="token string-literal"><span class="token string">&quot;desc&quot;</span></span> <span class="token constant">AS</span> t1_r3
<span class="token constant">FROM</span> <span class="token string-literal"><span class="token string">&quot;users&quot;</span></span> <span class="token constant">LEFT</span> <span class="token constant">OUTER</span> <span class="token constant">JOIN</span> <span class="token string-literal"><span class="token string">&quot;posts&quot;</span></span> <span class="token constant">ON</span> <span class="token string-literal"><span class="token string">&quot;posts&quot;</span></span><span class="token punctuation">.</span><span class="token string-literal"><span class="token string">&quot;user_id&quot;</span></span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;users&quot;</span></span><span class="token punctuation">.</span><span class="token string-literal"><span class="token string">&quot;id&quot;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>This is exactly what <strong>includes</strong> does when it is forced to make a single query when <strong>where</strong>
 or <strong>order</strong> clause is using an attribute from <strong>posts</strong> table.</p></li> <li><p>Scopes</p> <p>Scoping allows you to specify commonly-used queries which can be referenced as method calls on the association objects or models.</p> <p>To define a simple scope, we use the <code>[scope](https://api.rubyonrails.org/v7.0.4/classes/ActiveRecord/Scoping/Named/ClassMethods.html#method-i-scope)</code> method inside the class, passing the query that we'd like to run when this scope is called:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">Book</span> <span class="token operator">&lt;</span> ApplicationRecord
  scope <span class="token symbol">:out_of_print</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span> where<span class="token punctuation">(</span><span class="token symbol">out_of_print</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
	<span class="token comment">#chainble scope</span>
	scope <span class="token symbol">:out_of_print_and_expensive</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span> out_of_print<span class="token punctuation">.</span>where<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;price &gt; 500&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">}</span>

	<span class="token comment">#passing arguments</span>
	scope <span class="token symbol">:costs_more_than</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span> <span class="token punctuation">{</span> where<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;price &gt; ?&quot;</span></span><span class="token punctuation">,</span> amount<span class="token punctuation">)</span> <span class="token punctuation">}</span>
	<span class="token comment">#book.costs_more_than(500)</span>

	<span class="token comment">#conditions</span>
	scope <span class="token symbol">:created_before</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span> <span class="token punctuation">{</span> where<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;created_at &lt; ?&quot;</span></span><span class="token punctuation">,</span> time<span class="token punctuation">)</span> <span class="token keyword">if</span> time<span class="token punctuation">.</span>present<span class="token operator">?</span> <span class="token punctuation">}</span>

	<span class="token comment">#default scope</span>
	default_scope <span class="token punctuation">{</span> where<span class="token punctuation">(</span><span class="token symbol">out_of_print</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div></li> <li><p>Dynamic Filters</p> <p>For every field (also known as an attribute) you define in your table, Active Record provides a finder method. If you have a field called <code>first_name</code> on your <code>Customer</code> model for example, you get the instance method <code>find_by_first_name</code> for free from Active Record. If you also have a <code>locked</code>field on the <code>Customer</code> model, you also get <code>find_by_locked</code> method.</p> <p>You can specify an exclamation point (<code>!</code>) on the end of the dynamic finders to get them to raise an <code>ActiveRecord::RecordNotFound</code> error if they do not return any records, like <code>Customer.find_by_first_name!(&quot;Ryan&quot;)</code></p> <p>If you want to find both by <code>first_name</code> and <code>orders_count</code>, you can chain these finders together by simply typing &quot;<code>and</code>&quot; between the fields. For example, <code>Customer.find_by_first_name_and_orders_count(&quot;Ryan&quot;, 5)</code></p></li> <li><p>Enums</p> <p>An enum lets you define an Array of values for an attribute and refer to them by name. The actual value stored in the database is an integer that has been mapped to one of the values.</p> <p>Declaring an enum will:</p> <ul><li>Create scopes that can be used to find all objects that have or do not have one of the enum values</li> <li>Create an instance method that can be used to determine if an object has a particular value for the enum</li> <li>Create an instance method that can be used to change the enum value of an object</li></ul> <p>for all possible values of an enum.</p> <p>For example, given this <code>[enum](https://api.rubyonrails.org/v7.0.4/classes/ActiveRecord/Enum.html#method-i-enum)</code> declaration:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">Order</span> <span class="token operator">&lt;</span> ApplicationRecord
  enum <span class="token symbol">:status</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token symbol">:shipped</span><span class="token punctuation">,</span> <span class="token symbol">:being_packaged</span><span class="token punctuation">,</span> <span class="token symbol">:complete</span><span class="token punctuation">,</span> <span class="token symbol">:cancelled</span><span class="token punctuation">]</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>These <a href="https://guides.rubyonrails.org/active_record_querying.html#scopes" target="_blank" rel="noopener noreferrer">scopes<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> are created automatically and can be used to find all objects with or without a particular value for <code>status</code>:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>irb<span class="token operator">&gt;</span> Order<span class="token punctuation">.</span>shipped
<span class="token operator">=&gt;</span> <span class="token comment">#&lt;ActiveRecord::Relation&gt; # all orders with status == :shipped</span>
irb<span class="token operator">&gt;</span> Order<span class="token punctuation">.</span>not_shipped
<span class="token operator">=&gt;</span> <span class="token comment">#&lt;ActiveRecord::Relation&gt; # all orders with status != :shipped</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>These instance methods are created automatically and query whether the model has that value for the <code>status</code> enum:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>irb<span class="token operator">&gt;</span> order <span class="token operator">=</span> Order<span class="token punctuation">.</span>shipped<span class="token punctuation">.</span>first
irb<span class="token operator">&gt;</span> order<span class="token punctuation">.</span>shipped<span class="token operator">?</span>
<span class="token operator">=&gt;</span> <span class="token boolean">true</span>
irb<span class="token operator">&gt;</span> order<span class="token punctuation">.</span>complete<span class="token operator">?</span>
<span class="token operator">=&gt;</span> <span class="token boolean">false</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>These instance methods are created automatically and will first update the value of <code>status</code>
 to the named value and then query whether or not the status has been successfully set to the value:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>irb<span class="token operator">&gt;</span> order <span class="token operator">=</span> Order<span class="token punctuation">.</span>first
irb<span class="token operator">&gt;</span> order<span class="token punctuation">.</span>shipped<span class="token operator">!</span>
<span class="token constant">UPDATE</span> <span class="token string-literal"><span class="token string">&quot;orders&quot;</span></span> <span class="token constant">SET</span> <span class="token string-literal"><span class="token string">&quot;status&quot;</span></span> <span class="token operator">=</span> <span class="token operator">?</span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">&quot;updated_at&quot;</span></span> <span class="token operator">=</span> <span class="token operator">?</span> <span class="token constant">WHERE</span> <span class="token string-literal"><span class="token string">&quot;orders&quot;</span></span><span class="token punctuation">.</span><span class="token string-literal"><span class="token string">&quot;id&quot;</span></span> <span class="token operator">=</span> <span class="token operator">?</span>  <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string-literal"><span class="token string">&quot;status&quot;</span></span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">&quot;updated_at&quot;</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">&quot;2019-01-24 07:13:08.524320&quot;</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">&quot;id&quot;</span></span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token operator">=&gt;</span> <span class="token boolean">true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>Methods Chaining</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token comment">#Retrieving filtered data from multiple tables</span>
Customer
  <span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'customers.id, customers.last_name, reviews.body'</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span>joins<span class="token punctuation">(</span><span class="token symbol">:reviews</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span>where<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'reviews.created_at &gt; ?'</span></span><span class="token punctuation">,</span> <span class="token number">1.</span>week<span class="token punctuation">.</span>ago<span class="token punctuation">)</span>

<span class="token comment">#Retrieving specific data from multiple tables</span>
Book
  <span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'books.id, books.title, authors.first_name'</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span>joins<span class="token punctuation">(</span><span class="token symbol">:author</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span>find_by<span class="token punctuation">(</span><span class="token symbol">title</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">'Abstraction and Specification in Program Development'</span></span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li> <li><p>Find or build New Objects</p> <p>It's common that you need to find a record or create it if it doesn't exist. You can do that with the <code>find_or_create_by</code> and <code>find_or_create_by!</code>methods.</p> <p><strong><strong>find_or_create_by</strong></strong></p> <p>The <code>[find_or_create_by](https://api.rubyonrails.org/v7.0.4/classes/ActiveRecord/Relation.html#method-i-find_or_create_by)</code> method checks whether a record with the specified attributes exists. If it doesn't, then <code>create</code> is called. Let's see an example.</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>Customer<span class="token punctuation">.</span>find_or_create_by<span class="token punctuation">(</span><span class="token symbol">first_name</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">'Andy'</span></span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong><strong>find_or_create_by!</strong></strong></p> <p>You can also use <code>[find_or_create_by!](https://api.rubyonrails.org/v7.0.4/classes/ActiveRecord/Relation.html#method-i-find_or_create_by-21)</code>to raise an exception if the new record is invalid.</p> <p><strong><strong>find_or_initialize_by</strong></strong></p> <p>The <code>[find_or_initialize_by](https://api.rubyonrails.org/v7.0.4/classes/ActiveRecord/Relation.html#method-i-find_or_initialize_by)</code>method will work just like <code>find_or_create_by</code>
 but it will call <code>new</code> instead of <code>create</code>.</p></li> <li><p>Find by SQL</p> <p><strong>find_by_sql</strong></p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>Customer<span class="token punctuation">.</span>find_by_sql<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;SELECT * FROM customers INNER JOIN orders ON customers.id = orders.customer_id ORDER BY customers.created_at desc&quot;</span></span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong><strong>select_all</strong></strong></p> <p><code>select_all</code>will retrieve objects from the database using custom SQL just like <code>find_by_sql</code>
but will not instantiate them. This method will return an instance of <code>ActiveRecord::Result</code>
class and calling <code>to_a</code>on this object would return you an array of hashes where each hash indicates a record.</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>irb<span class="token operator">&gt;</span> Customer<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>select_all<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;SELECT first_name, created_at FROM customers WHERE id = '1'&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span>to_a
<span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string-literal"><span class="token string">&quot;first_name&quot;</span></span><span class="token operator">=&gt;</span><span class="token string-literal"><span class="token string">&quot;Rafael&quot;</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">&quot;created_at&quot;</span></span><span class="token operator">=&gt;</span><span class="token string-literal"><span class="token string">&quot;2012-11-10 23:23:45.281189&quot;</span></span><span class="token punctuation">}</span><span class="token punctuation">,</span> 
<span class="token punctuation">{</span><span class="token string-literal"><span class="token string">&quot;first_name&quot;</span></span><span class="token operator">=&gt;</span><span class="token string-literal"><span class="token string">&quot;Eileen&quot;</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">&quot;created_at&quot;</span></span><span class="token operator">=&gt;</span><span class="token string-literal"><span class="token string">&quot;2013-12-09 11:22:35.221282&quot;</span></span><span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong><strong>pluck</strong></strong></p> <p><code>[pluck](https://api.rubyonrails.org/v7.0.4/classes/ActiveRecord/Calculations.html#method-i-pluck)</code>can be used to query single or multiple columns from the underlying table of a model. It accepts a list of column names as an argument and returns an array of values of the specified columns with the corresponding data type.</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>irb<span class="token operator">&gt;</span> Book<span class="token punctuation">.</span>where<span class="token punctuation">(</span><span class="token symbol">out_of_print</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span>pluck<span class="token punctuation">(</span><span class="token symbol">:id</span><span class="token punctuation">)</span>
<span class="token constant">SELECT</span> id <span class="token constant">FROM</span> books <span class="token constant">WHERE</span> out_of_print <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>

irb<span class="token operator">&gt;</span> Order<span class="token punctuation">.</span>distinct<span class="token punctuation">.</span>pluck<span class="token punctuation">(</span><span class="token symbol">:status</span><span class="token punctuation">)</span>
<span class="token constant">SELECT</span> <span class="token constant">DISTINCT</span> status <span class="token constant">FROM</span> orders
<span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">&quot;shipped&quot;</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">&quot;being_packed&quot;</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">&quot;cancelled&quot;</span></span><span class="token punctuation">]</span>

irb<span class="token operator">&gt;</span> Customer<span class="token punctuation">.</span>pluck<span class="token punctuation">(</span><span class="token symbol">:id</span><span class="token punctuation">,</span> <span class="token symbol">:first_name</span><span class="token punctuation">)</span>
<span class="token constant">SELECT</span> customers<span class="token punctuation">.</span>id<span class="token punctuation">,</span> customers<span class="token punctuation">.</span>first_name <span class="token constant">FROM</span> customers
<span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">&quot;David&quot;</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">&quot;Fran&quot;</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">&quot;Jose&quot;</span></span><span class="token punctuation">]</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>ids</strong></p> <p><code>[ids](https://api.rubyonrails.org/v7.0.4/classes/ActiveRecord/Calculations.html#method-i-ids)</code> can be used to pluck all the IDs for the relation using the table's primary key.</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>irb<span class="token operator">&gt;</span> Customer<span class="token punctuation">.</span>ids
<span class="token constant">SELECT</span> id <span class="token constant">FROM</span> customers
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>Existence of Objects</p> <p>If you simply want to check for the existence of the object there's a method called <code>[exists?](https://api.rubyonrails.org/v7.0.4/classes/ActiveRecord/FinderMethods.html#method-i-exists-3F)</code>. This method will query the database using the same query as <code>find</code>, but instead of returning an object or collection of objects it will return either <code>true</code>or <code>false</code>.</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>Customer<span class="token punctuation">.</span>exists<span class="token operator">?</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

Customer<span class="token punctuation">.</span>exists<span class="token operator">?</span><span class="token punctuation">(</span><span class="token symbol">id</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># or</span>
Customer<span class="token punctuation">.</span>exists<span class="token operator">?</span><span class="token punctuation">(</span><span class="token symbol">first_name</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">'Jane'</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">'Sergei'</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span>

Customer<span class="token punctuation">.</span>where<span class="token punctuation">(</span><span class="token symbol">first_name</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">'Ryan'</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span>exists<span class="token operator">?</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>Calculations</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token comment">#count</span>
Customer<span class="token punctuation">.</span>count

<span class="token comment">#average</span>
Order<span class="token punctuation">.</span>average<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;subtotal&quot;</span></span><span class="token punctuation">)</span>

<span class="token comment">#minimum</span>
Order<span class="token punctuation">.</span>minimum<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;subtotal&quot;</span></span><span class="token punctuation">)</span>

<span class="token comment">#maximum</span>
Order<span class="token punctuation">.</span>maximum<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;subtotal&quot;</span></span><span class="token punctuation">)</span>

<span class="token comment">#sum</span>
Order<span class="token punctuation">.</span>sum<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;subtotal&quot;</span></span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/database/Callbacks.html" class="prev">
        Callbacks
      </a></span> <span class="next"><a href="/digging_deeper/">
        Digging Deeper
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.7adc5413.js" defer></script><script src="/assets/js/2.72a95a92.js" defer></script><script src="/assets/js/15.71342207.js" defer></script>
  </body>
</html>
