<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Active Record Migrations |  Ruby on Rails Documentattion </title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="RoR Documentation for Beginners">
    
    <link rel="preload" href="/assets/css/0.styles.d6ad21ed.css" as="style"><link rel="preload" href="/assets/js/app.7adc5413.js" as="script"><link rel="preload" href="/assets/js/2.72a95a92.js" as="script"><link rel="preload" href="/assets/js/10.a520d8be.js" as="script"><link rel="prefetch" href="/assets/js/11.f290d03c.js"><link rel="prefetch" href="/assets/js/12.52c96c43.js"><link rel="prefetch" href="/assets/js/13.2df3af10.js"><link rel="prefetch" href="/assets/js/14.840b181d.js"><link rel="prefetch" href="/assets/js/15.71342207.js"><link rel="prefetch" href="/assets/js/16.9d4ff7c3.js"><link rel="prefetch" href="/assets/js/17.842c0f28.js"><link rel="prefetch" href="/assets/js/18.93bc7927.js"><link rel="prefetch" href="/assets/js/19.5935f0d0.js"><link rel="prefetch" href="/assets/js/20.cdf58d7d.js"><link rel="prefetch" href="/assets/js/21.3166d2bf.js"><link rel="prefetch" href="/assets/js/22.b1a0c7ae.js"><link rel="prefetch" href="/assets/js/23.df366c28.js"><link rel="prefetch" href="/assets/js/24.fc6d5a86.js"><link rel="prefetch" href="/assets/js/25.2115eb5e.js"><link rel="prefetch" href="/assets/js/26.a5569d65.js"><link rel="prefetch" href="/assets/js/27.214f9614.js"><link rel="prefetch" href="/assets/js/28.6263065f.js"><link rel="prefetch" href="/assets/js/29.0f98370e.js"><link rel="prefetch" href="/assets/js/3.447679a1.js"><link rel="prefetch" href="/assets/js/30.1182db89.js"><link rel="prefetch" href="/assets/js/31.38016aaf.js"><link rel="prefetch" href="/assets/js/32.626ffe2b.js"><link rel="prefetch" href="/assets/js/33.039db41a.js"><link rel="prefetch" href="/assets/js/34.76b65e88.js"><link rel="prefetch" href="/assets/js/35.1f504bd2.js"><link rel="prefetch" href="/assets/js/36.2089506c.js"><link rel="prefetch" href="/assets/js/37.54d694f8.js"><link rel="prefetch" href="/assets/js/38.8a179bd0.js"><link rel="prefetch" href="/assets/js/39.3159a702.js"><link rel="prefetch" href="/assets/js/4.fb941f04.js"><link rel="prefetch" href="/assets/js/40.3697d274.js"><link rel="prefetch" href="/assets/js/41.b554a771.js"><link rel="prefetch" href="/assets/js/42.45c82fe7.js"><link rel="prefetch" href="/assets/js/43.b54c5bed.js"><link rel="prefetch" href="/assets/js/44.fbcc36d7.js"><link rel="prefetch" href="/assets/js/5.384b96a2.js"><link rel="prefetch" href="/assets/js/6.d92e70ec.js"><link rel="prefetch" href="/assets/js/7.189f016f.js"><link rel="prefetch" href="/assets/js/8.f4a80106.js"><link rel="prefetch" href="/assets/js/9.1176b470.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d6ad21ed.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name"> Ruby on Rails Documentattion </span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">Ruby on rails</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Getting Started</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Architecture Concepts</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>The Basic</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Database</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/database/" aria-current="page" class="sidebar-link">Database</a></li><li><a href="/database/Configurations.html" class="sidebar-link">Configurations</a></li><li><a href="/database/Active Record ORM.html" class="sidebar-link">Active Record ORM</a></li><li><a href="/database/Active Record Migrations.html" class="active sidebar-link">Active Record Migrations</a></li><li><a href="/database/Model.html" class="sidebar-link">Model</a></li><li><a href="/database/Validation.html" class="sidebar-link">Validation</a></li><li><a href="/database/Relationships.html" class="sidebar-link">Relationships</a></li><li><a href="/database/Callbacks.html" class="sidebar-link">Callbacks</a></li><li><a href="/database/Query Builder.html" class="sidebar-link">Query Builder</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Digging Deeper</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Security</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Testing</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Packages</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="active-record-migrations"><a href="#active-record-migrations" class="header-anchor">#</a> Active Record Migrations</h1> <ul><li><p>Introduction</p> <p>Migrations are like version control for your database, allowing your team to define and share the application's database schema definition. If you have ever had to tell a teammate to manually add a column to their local database schema after pulling in your changes from source control, you've faced the problem that database migrations solve.</p></li> <li><p>Generating Migrations</p> <p>You may use the <code>bin/rails generate migration</code>rails command to generate a database migration. The new migration will be placed in your **<code>db/migrate</code>**directory. Each migration filename contains a timestamp that allows Laravel to determine the order of the migrations:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>bin/rails generate migration AddPartNumberToProducts
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>This will create an appropriately named empty migration:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">AddPartNumberToProducts</span> <span class="token operator">&lt;</span> ActiveRecord<span class="token double-colon punctuation">::</span>Migration<span class="token punctuation">[</span><span class="token number">7.0</span><span class="token punctuation">]</span>
  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">change</span></span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Rials will use the name of the migration to attempt to guess the name of the table and whether or not the migration will be creating a new table. If Rails is able to determine the table name from the migration name, Rails will pre-fill the generated migration file with the specified table. Otherwise, you may simply specify the table in the migration file manually.</p> <p>If the migration name is of the form &quot;AddColumnToTable&quot; or &quot;RemoveColumnFromTable&quot; and is followed by a list of column names and types then a migration containing the appropriate <code>[add_column](https://api.rubyonrails.org/v7.0.4/classes/ActiveRecord/ConnectionAdapters/SchemaStatements.html#method-i-add_column)</code>and <code>[remove_column](https://api.rubyonrails.org/v7.0.4/classes/ActiveRecord/ConnectionAdapters/SchemaStatements.html#method-i-remove_column)</code>statements will be created.</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>bin<span class="token operator">/</span>rails generate migration AddPartNumberToProducts part_number<span class="token symbol">:string</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>will generate</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">AddPartNumberToProducts</span> <span class="token operator">&lt;</span> ActiveRecord<span class="token double-colon punctuation">::</span>Migration<span class="token punctuation">[</span><span class="token number">7.0</span><span class="token punctuation">]</span>
  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">change</span></span>
    add_column <span class="token symbol">:products</span><span class="token punctuation">,</span> <span class="token symbol">:part_number</span><span class="token punctuation">,</span> <span class="token symbol">:string</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>Migration Structure</p> <p>Sometimes we see the method name is <code>up</code>and <code>down</code>and sometimes we see the method name is <code>change</code>in the migration file.</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">AddPartNumberToProducts</span> <span class="token operator">&lt;</span> ActiveRecord<span class="token double-colon punctuation">::</span>Migration<span class="token punctuation">[</span><span class="token number">7.0</span><span class="token punctuation">]</span>
  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">change</span></span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>You can also use the old style of migration using <code>up</code>and <code>down</code>methods instead of the <code>change</code>method. The <code>up</code>method should describe the transformation you'd like to make to your schema, and the <code>down</code>method of your migration should revert the transformations done by the <code>up</code>method.</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">ExampleMigration</span> <span class="token operator">&lt;</span> ActiveRecord<span class="token double-colon punctuation">::</span>Migration<span class="token punctuation">[</span><span class="token number">7.0</span><span class="token punctuation">]</span>
  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">up</span></span>
    create_table <span class="token symbol">:distributors</span> <span class="token keyword">do</span> <span class="token operator">|</span>t<span class="token operator">|</span>
      t<span class="token punctuation">.</span>string <span class="token symbol">:zipcode</span>
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">down</span></span>
    drop_table <span class="token symbol">:distributors</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li> <li><p>Running Migration</p> <p>To run all of your outstanding migrations, execute the <strong><code>migrate</code></strong> Artisan command:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>bin<span class="token operator">/</span>rails db<span class="token symbol">:migrate</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>If you would like to see which migrations have run thus far, you may use the <strong><code>migrate:status</code></strong>
rails command:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>bin<span class="token operator">/</span>rails db<span class="token symbol">:migrate</span><span class="token operator">:</span>status
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>If you specify a target version, Active Record will run the required migrations (change, up, down) until it has reached the specified version. The version is the numerical prefix on the migration's filename. For example, to migrate to version 20080906120000 run:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>bin<span class="token operator">/</span>rails db<span class="token symbol">:migrate</span> <span class="token constant">VERSION</span><span class="token operator">=</span><span class="token number">20080906120000</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>If version 20080906120000 is greater than the current version (i.e., it is migrating upwards), this will run the <code>change</code>(or <code>up</code>) method on all migrations up to and including 20080906120000,  and will not execute any later migrations. If migrating downwards, this will run the <code>down</code>method on all the migrations down to, but not including, 20080906120000.</p> <p>By default running <code>bin/rails db:migrate</code>will run in the <code>development</code>environment. To run migrations against another environment you can specify it using the <code>RAILS_ENV</code>environment variable while running the command. For example to run migrations against the <code>test</code> environment you could run:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>bin<span class="token operator">/</span>rails db<span class="token symbol">:migrate</span> <span class="token constant">RAILS_ENV</span><span class="token operator">=</span>test
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong><strong>Rolling Back</strong></strong></p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>bin<span class="token operator">/</span>rails db<span class="token symbol">:rollback</span>

bin<span class="token operator">/</span>rails db<span class="token symbol">:rollback</span> <span class="token constant">STEP</span><span class="token operator">=</span><span class="token number">3</span>

<span class="token comment">#shortcut for doing a rollback and then migrating back up again.</span>
bin<span class="token operator">/</span>rails db<span class="token symbol">:migrate</span><span class="token operator">:</span><span class="token keyword">redo</span> <span class="token constant">STEP</span><span class="token operator">=</span><span class="token number">3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>Table</p> <ul><li><p><strong>Creating Table</strong></p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>create_table <span class="token symbol">:products</span> <span class="token keyword">do</span> <span class="token operator">|</span>t<span class="token operator">|</span>
  t<span class="token punctuation">.</span>string <span class="token symbol">:name</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>which creates a <code>products</code> table with a column called <code>name</code>.</p> <p>By default, <code>create_table</code> will create a primary key called <code>id</code>. You can change the name of the primary key with the <code>:primary_key</code> option or, if you don't want a primary key at all, you can pass the option <code>id: false</code>. If you need to pass database specific options you can place an SQL fragment in the <code>:options</code> option. For example:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>create_table <span class="token symbol">:products</span><span class="token punctuation">,</span> <span class="token symbol">options</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">&quot;ENGINE=BLACKHOLE&quot;</span></span> <span class="token keyword">do</span> <span class="token operator">|</span>t<span class="token operator">|</span>
  t<span class="token punctuation">.</span>string <span class="token symbol">:name</span><span class="token punctuation">,</span> <span class="token symbol">null</span><span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>will append <code>ENGINE=BLACKHOLE</code> to the SQL statement used to create the table.</p> <p>An index can be created on the columns created within the <code>create_table</code>block by passing true or an options hash to the <code>:index</code>option:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>create_table <span class="token symbol">:users</span> <span class="token keyword">do</span> <span class="token operator">|</span>t<span class="token operator">|</span>
  t<span class="token punctuation">.</span>string <span class="token symbol">:name</span><span class="token punctuation">,</span> <span class="token symbol">index</span><span class="token operator">:</span> <span class="token boolean">true</span>
  t<span class="token punctuation">.</span>string <span class="token symbol">:email</span><span class="token punctuation">,</span> <span class="token symbol">index</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token symbol">unique</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token symbol">name</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">'unique_emails'</span></span> <span class="token punctuation">}</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p><strong><strong>Creating a Join Table</strong></strong></p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>create_join_table <span class="token symbol">:products</span><span class="token punctuation">,</span> <span class="token symbol">:categories</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>which creates a <code>categories_products</code>table with two columns called <code>category_id</code> and  <code>product_id</code>. These columns have the option <code>:null</code> set to <code>false</code>by default. This can be overridden by specifying the <code>:column_options</code>option:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>create_join_table <span class="token symbol">:products</span><span class="token punctuation">,</span> <span class="token symbol">:categories</span><span class="token punctuation">,</span> <span class="token symbol">column_options</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token symbol">null</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>By default, the name of the join table comes from the union of the first two arguments provided to create_join_table, in alphabetical order. To customize the name of the table, provide a <code>:table_name</code>option:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>create_join_table <span class="token symbol">:products</span><span class="token punctuation">,</span> <span class="token symbol">:categories</span><span class="token punctuation">,</span> <span class="token symbol">table_name</span><span class="token operator">:</span> <span class="token symbol">:categorization</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>creates a <code>categorization</code> table.</p> <p><code>create_join_table</code>also accepts a block, which you can use to add indices (which are not created by default) or additional columns:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>create_join_table <span class="token symbol">:products</span><span class="token punctuation">,</span> <span class="token symbol">:categories</span> <span class="token keyword">do</span> <span class="token operator">|</span>t<span class="token operator">|</span>
  t<span class="token punctuation">.</span>index <span class="token symbol">:product_id</span>
  t<span class="token punctuation">.</span>index <span class="token symbol">:category_id</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p><strong>Changing Table</strong></p> <p>A close cousin of <code>create_table</code>is <code>[change_table](https://api.rubyonrails.org/v7.0.4/classes/ActiveRecord/ConnectionAdapters/SchemaStatements.html#method-i-change_table)</code>, used for changing existing tables. It is used in a similar fashion to <code>create_table</code>but the object yielded to the block knows more tricks. For example:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>change_table <span class="token symbol">:products</span> <span class="token keyword">do</span> <span class="token operator">|</span>t<span class="token operator">|</span>
  t<span class="token punctuation">.</span>remove <span class="token symbol">:description</span><span class="token punctuation">,</span> <span class="token symbol">:name</span>
  t<span class="token punctuation">.</span>string <span class="token symbol">:part_number</span>
  t<span class="token punctuation">.</span>index <span class="token symbol">:part_number</span>
  t<span class="token punctuation">.</span>rename <span class="token symbol">:upccode</span><span class="token punctuation">,</span> <span class="token symbol">:upc_code</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>removes the <code>description</code>and <code>name</code>columns, creates a <code>part_number</code>string column and adds an index on it. Finally it renames the <code>upccode</code>column.</p></li> <li><p><strong>Changing Columns</strong></p> <p>Like the <code>remove_column</code>and <code>add_column</code>Rails provides the <code>[change_column](https://api.rubyonrails.org/v7.0.4/classes/ActiveRecord/ConnectionAdapters/SchemaStatements.html#method-i-change_column)</code>migration method.</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>change_column <span class="token symbol">:products</span><span class="token punctuation">,</span> <span class="token symbol">:part_number</span><span class="token punctuation">,</span> <span class="token symbol">:text</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>This changes the column <code>part_number</code> on products table to be a <code>:text</code> field. Note that <code>change_column</code> command is irreversible.</p> <p>Besides <code>change_column</code>,the <code>[change_column_null](https://api.rubyonrails.org/v7.0.4/classes/ActiveRecord/ConnectionAdapters/SchemaStatements.html#method-i-change_column_null)</code> and <code>[change_column_default](https://api.rubyonrails.org/v7.0.4/classes/ActiveRecord/ConnectionAdapters/SchemaStatements.html#method-i-change_column_default)</code> method are used specifically to change a not null constraint and default values of a column.</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>change_column_null <span class="token symbol">:products</span><span class="token punctuation">,</span> <span class="token symbol">:name</span><span class="token punctuation">,</span> <span class="token boolean">false</span>
change_column_default <span class="token symbol">:products</span><span class="token punctuation">,</span> <span class="token symbol">:approved</span><span class="token punctuation">,</span> <span class="token symbol">from</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token symbol">to</span><span class="token operator">:</span> <span class="token boolean">false</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>This sets <code>:name</code>field on products to a <code>NOT NULL</code>column and the default value of the <code>:approved</code>field from true to false.</p></li> <li><p><strong><strong>References</strong></strong></p> <p>The <code>add_reference</code> method allows the creation of an appropriately named column.</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>add_reference <span class="token symbol">:users</span><span class="token punctuation">,</span> <span class="token symbol">:role</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>This migration will create a <code>role_id</code>column in the users table. It creates an index for this column as well, unless explicitly told not with the <code>index: false</code>option:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>add_reference <span class="token symbol">:users</span><span class="token punctuation">,</span> <span class="token symbol">:role</span><span class="token punctuation">,</span> <span class="token symbol">index</span><span class="token operator">:</span> <span class="token boolean">false</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>The method <code>add_belongs_to</code> is an alias of <code>add_reference</code>.</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>add_belongs_to <span class="token symbol">:taggings</span><span class="token punctuation">,</span> <span class="token symbol">:taggable</span><span class="token punctuation">,</span> <span class="token symbol">polymorphic</span><span class="token operator">:</span> <span class="token boolean">true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>The polymorphic option will create two columns on the taggings table which can be used for polymorphic associations: <code>taggable_type</code> and <code>taggable_id</code>.</p> <p>A foreign key can be created with the <code>foreign_key</code> option.</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>add_reference <span class="token symbol">:users</span><span class="token punctuation">,</span> <span class="token symbol">:role</span><span class="token punctuation">,</span> <span class="token symbol">foreign_key</span><span class="token operator">:</span> <span class="token boolean">true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>References can also be removed:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>remove_reference <span class="token symbol">:products</span><span class="token punctuation">,</span> <span class="token symbol">:user</span><span class="token punctuation">,</span> <span class="token symbol">foreign_key</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token symbol">index</span><span class="token operator">:</span> <span class="token boolean">false</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><strong><strong>When Helpers aren't Enough</strong></strong></p> <p>If the helpers provided by Active Record aren't enough you can use the <code>[execute](https://api.rubyonrails.org/v7.0.4/classes/ActiveRecord/ConnectionAdapters/DatabaseStatements.html#method-i-execute)</code> method to execute arbitrary SQL:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>Product<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;UPDATE products SET price = 'free' WHERE 1=1&quot;</span></span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/database/Active Record ORM.html" class="prev">
        Active Record ORM
      </a></span> <span class="next"><a href="/database/Model.html">
        Model
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.7adc5413.js" defer></script><script src="/assets/js/2.72a95a92.js" defer></script><script src="/assets/js/10.a520d8be.js" defer></script>
  </body>
</html>
