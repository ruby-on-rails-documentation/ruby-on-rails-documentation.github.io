<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Controller |  Ruby on Rails Documentattion </title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="RoR Documentation for Beginners">
    
    <link rel="preload" href="/assets/css/0.styles.d6ad21ed.css" as="style"><link rel="preload" href="/assets/js/app.7adc5413.js" as="script"><link rel="preload" href="/assets/js/2.72a95a92.js" as="script"><link rel="preload" href="/assets/js/34.76b65e88.js" as="script"><link rel="prefetch" href="/assets/js/10.a520d8be.js"><link rel="prefetch" href="/assets/js/11.f290d03c.js"><link rel="prefetch" href="/assets/js/12.52c96c43.js"><link rel="prefetch" href="/assets/js/13.2df3af10.js"><link rel="prefetch" href="/assets/js/14.840b181d.js"><link rel="prefetch" href="/assets/js/15.71342207.js"><link rel="prefetch" href="/assets/js/16.9d4ff7c3.js"><link rel="prefetch" href="/assets/js/17.842c0f28.js"><link rel="prefetch" href="/assets/js/18.93bc7927.js"><link rel="prefetch" href="/assets/js/19.5935f0d0.js"><link rel="prefetch" href="/assets/js/20.cdf58d7d.js"><link rel="prefetch" href="/assets/js/21.3166d2bf.js"><link rel="prefetch" href="/assets/js/22.b1a0c7ae.js"><link rel="prefetch" href="/assets/js/23.df366c28.js"><link rel="prefetch" href="/assets/js/24.fc6d5a86.js"><link rel="prefetch" href="/assets/js/25.2115eb5e.js"><link rel="prefetch" href="/assets/js/26.a5569d65.js"><link rel="prefetch" href="/assets/js/27.214f9614.js"><link rel="prefetch" href="/assets/js/28.6263065f.js"><link rel="prefetch" href="/assets/js/29.0f98370e.js"><link rel="prefetch" href="/assets/js/3.447679a1.js"><link rel="prefetch" href="/assets/js/30.1182db89.js"><link rel="prefetch" href="/assets/js/31.38016aaf.js"><link rel="prefetch" href="/assets/js/32.626ffe2b.js"><link rel="prefetch" href="/assets/js/33.039db41a.js"><link rel="prefetch" href="/assets/js/35.1f504bd2.js"><link rel="prefetch" href="/assets/js/36.2089506c.js"><link rel="prefetch" href="/assets/js/37.54d694f8.js"><link rel="prefetch" href="/assets/js/38.8a179bd0.js"><link rel="prefetch" href="/assets/js/39.3159a702.js"><link rel="prefetch" href="/assets/js/4.fb941f04.js"><link rel="prefetch" href="/assets/js/40.3697d274.js"><link rel="prefetch" href="/assets/js/41.b554a771.js"><link rel="prefetch" href="/assets/js/42.45c82fe7.js"><link rel="prefetch" href="/assets/js/43.b54c5bed.js"><link rel="prefetch" href="/assets/js/44.fbcc36d7.js"><link rel="prefetch" href="/assets/js/5.384b96a2.js"><link rel="prefetch" href="/assets/js/6.d92e70ec.js"><link rel="prefetch" href="/assets/js/7.189f016f.js"><link rel="prefetch" href="/assets/js/8.f4a80106.js"><link rel="prefetch" href="/assets/js/9.1176b470.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d6ad21ed.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name"> Ruby on Rails Documentattion </span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">Ruby on rails</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Getting Started</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Architecture Concepts</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>The Basic</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/the_basic/" aria-current="page" class="sidebar-link">The Basic</a></li><li><a href="/the_basic/Routing.html" class="sidebar-link">Routing</a></li><li><a href="/the_basic/CSRF Protection.html" class="sidebar-link">CSRF Protection</a></li><li><a href="/the_basic/Controller.html" aria-current="page" class="active sidebar-link">Controller</a></li><li><a href="/the_basic/Request.html" class="sidebar-link">Request</a></li><li><a href="/the_basic/Response.html" class="sidebar-link">Response</a></li><li><a href="/the_basic/ERB Template.html" class="sidebar-link">ERB Template</a></li><li><a href="/the_basic/Asset Bundling Webpacker.html" class="sidebar-link">Asset Bundling (Webpacker)</a></li><li><a href="/the_basic/URL Generation.html" class="sidebar-link">URL Generation</a></li><li><a href="/the_basic/Sessions.html" class="sidebar-link">Sessions</a></li><li><a href="/the_basic/Validations.html" class="sidebar-link">Validations</a></li><li><a href="/the_basic/Logging.html" class="sidebar-link">Logging</a></li><li><a href="/the_basic/Error Handling.html" class="sidebar-link">Error Handling</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Database</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Digging Deeper</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Security</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Testing</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Packages</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="controller"><a href="#controller" class="header-anchor">#</a> Controller</h1> <p>Controllers can group related request handling logic into a single class. For example, a **<code>UserController</code>**class might handle all incoming requests related to users, including showing, creating, updating, and deleting users. By default, controllers are stored in the **<code>app/Controllers</code>**directory.</p> <ul><li><p>Writing Controller</p> <ul><li><p>Controller Naming Convention</p> <p>The naming convention of controllers in Rails favors pluralization of the last word in the controller's name, although it is not strictly required (e.g. <code>ApplicationController</code>). For example, <code>ClientsController</code> is preferable to  <code>ClientController</code>,  <code>SiteAdminsController</code>  is preferable to  <code>SiteAdminController</code>  or  <code>SitesAdminsController</code>,  and so on.</p> <p>Following this convention will allow you to use the default route generators (e.g. <code>resources</code>, etc) without needing to qualify each <code>:path</code> or <code>:controller</code>, and will keep named route helpers' usage consistent throughout your application.</p></li> <li><p>Basic Controllers</p> <p>A controller is a Ruby class which inherits from <code>ApplicationController</code>
 and has methods just like any other class. When your application receives a request, the routing will determine which controller and action to run, then Rails creates an instance of that controller and runs the method with the same name as the action.</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">ClientsController</span> <span class="token operator">&lt;</span> ApplicationController
  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">new</span></span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>As an example, if a user goes to <code>/clients/new</code>in your application to add a new client, Rails will create an instance of <code>ClientsController</code>and call its <code>new</code>method.  Note that the empty method from the example above would work just fine because Rails will by default render the <code>new.html.erb</code>view unless the action says otherwise. By creating a new <code>Client</code>, the <code>new</code>method can make a <code>@client</code> instance variable accessible in the view:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">def</span> <span class="token method-definition"><span class="token function">new</span></span>
  <span class="token variable">@client</span> <span class="token operator">=</span> <span class="token class-name">Client</span><span class="token punctuation">.</span><span class="token keyword">new</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ul></li> <li><p>Controller Filters</p> <p>Filters are methods that are run &quot;before&quot;, &quot;after&quot; or &quot;around&quot; a controller action.</p> <p>Filters are inherited, so if you set a filter on <code>ApplicationController</code>, it will be run on every controller in your application.</p> <ul><li><p>Before</p> <p>&quot;before&quot; filters are registered via <code>before_action</code>. They may halt the request cycle. A common &quot;before&quot; filter is one which requires that a user is logged in for an action to be run. You can define the filter method this way:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">ApplicationController</span> <span class="token operator">&lt;</span> ActionController<span class="token double-colon punctuation">::</span>Base
  before_action <span class="token symbol">:require_login</span>

  <span class="token keyword">private</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">require_login</span></span>
    <span class="token keyword">unless</span> logged_in<span class="token operator">?</span>
      flash<span class="token punctuation">[</span><span class="token symbol">:error</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;You must be logged in to access this section&quot;</span></span>
      redirect_to new_login_url <span class="token comment"># halts request cycle</span>
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>The method simply stores an error message in the flash and redirects to the login form if the user is not logged in. If a &quot;before&quot; filter renders or redirects, the action will not run. If there are additional filters scheduled to run after that filter, they are also cancelled.</p> <p>In this example, the filter is added to <code>ApplicationController</code> and thus all controllers in the application inherit it. This will make everything in the application require the user to be logged in to use it. For obvious reasons (the user wouldn't be able to log in in the first place!), not all controllers or actions should require this. You can prevent this filter from running before particular actions with <code>skip_before_action</code>:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">LoginsController</span> <span class="token operator">&lt;</span> ApplicationController
  skip_before_action <span class="token symbol">:require_login</span><span class="token punctuation">,</span> <span class="token symbol">only</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token symbol">:new</span><span class="token punctuation">,</span> <span class="token symbol">:create</span><span class="token punctuation">]</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>After Filters and Around Filters</p> <p>In addition to &quot;before&quot; filters, you can also run filters after an action has been executed, or both before and after.</p> <p>&quot;after&quot; filters are registered via <code>after_action</code>. They are similar to &quot;before&quot; filters, but because the action has already been run they have access to the response data that's about to be sent to the client. Obviously, &quot;after&quot; filters cannot stop the action from running. Please note that &quot;after&quot; filters are executed only after a successful action, but not when an exception is raised in the request cycle.</p> <p>&quot;around&quot; filters are registered via <code>around_action</code>. They are responsible for running their associated actions by yielding, similar to how Rack middlewares work.</p> <p>For example, in a website where changes have an approval workflow, an administrator could preview them easily by applying them within a transaction:</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">class</span> <span class="token class-name">ChangesController</span> <span class="token operator">&lt;</span> ApplicationController
  around_action <span class="token symbol">:wrap_in_transaction</span><span class="token punctuation">,</span> <span class="token symbol">only</span><span class="token operator">:</span> <span class="token symbol">:show</span>

  <span class="token keyword">private</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">wrap_in_transaction</span></span>
    ActiveRecord<span class="token double-colon punctuation">::</span>Base<span class="token punctuation">.</span>transaction <span class="token keyword">do</span>
      <span class="token keyword">begin</span>
        <span class="token keyword">yield</span>
      <span class="token keyword">ensure</span>
        <span class="token keyword">raise</span> ActiveRecord<span class="token double-colon punctuation">::</span>Rollback
      <span class="token keyword">end</span>
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>Note that an &quot;around&quot; filter also wraps rendering. In particular, in the example above, if the view itself reads from the database (e.g. via a scope), it will do so within the transaction and thus present the data to preview.</p> <p>You can choose not to yield and build the response yourself, in which case the action will not be run.</p></li></ul></li> <li><p>Controller Generation</p> <p>Using generators will save you a large amount of time by writing <strong>boilerplate code</strong>
, code that is necessary for the app to work.</p> <p>Let's make our own controller with the controller generator. But what command should we use? Let's ask the generator:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>bin/rails generate controller

Usage: bin/rails generate controller NAME <span class="token punctuation">[</span>action action<span class="token punctuation">]</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span>

<span class="token punctuation">..</span>.
<span class="token punctuation">..</span>.

Description:
    <span class="token punctuation">..</span>.

    To create a controller within a module, specify the controller name as a path like <span class="token string">'parent_module/controller_name'</span><span class="token builtin class-name">.</span>

    <span class="token punctuation">..</span>.

Example:
    <span class="token variable"><span class="token variable">`</span>bin/rails generate controller CreditCards <span class="token function">open</span> debit credit close<span class="token variable">`</span></span>

    Credit card controller with URLs like /credit_cards/debit.
        Controller: app/controllers/credit_cards_controller.rb
        Test:       test/controllers/credit_cards_controller_test.rb
        Views:      app/views/credit_cards/debit.html.erb <span class="token punctuation">[</span><span class="token punctuation">..</span>.<span class="token punctuation">]</span>
        Helper:     app/helpers/credit_cards_helper.rb
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>The controller generator is expecting parameters in the form of <code>generate controller ControllerName action1 action2</code>. Let's make a <code>Greetings</code>controller with an action of <strong>hello</strong>
, which will say something nice to us.</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>bin/rails generate controller Greetings hello

     create  app/controllers/greetings_controller.rb
      route  get <span class="token string">'greetings/hello'</span>
     invoke  erb
     create    app/views/greetings
     create    app/views/greetings/hello.html.erb
     invoke  test_unit
     create    test/controllers/greetings_controller_test.rb
     invoke  helper
     create    app/helpers/greetings_helper.rb
     invoke    test_unit
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>What all did this generate? It made sure a bunch of directories were in our application, and created a controller file, a view file, a functional test file, a helper for the view, a JavaScript file, and a stylesheet file.</p> <p>Check out the controller and modify it a little(in <code>app/controllers/greetings_controller.rb</code>
):</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>class GreetingsController <span class="token operator">&lt;</span> ApplicationController
  def hello
    @message <span class="token operator">=</span> <span class="token string">&quot;Hello, how are you today?&quot;</span>
  end
end
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Then the view, to display our message (in <code>app/views/greetings/hello.html.erb</code>):</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token operator">&lt;</span>h<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>A Greeting <span class="token keyword">for</span> You<span class="token operator">!</span><span class="token operator">&lt;</span>/h<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>
<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token operator">&lt;</span>%<span class="token operator">=</span> @message %<span class="token operator">&gt;</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Fire up your server using <code>bin/rails server</code>.</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>bin/rails server

Booting Puma<span class="token punctuation">..</span>.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>The URL will be <a href="http://localhost:3000/greetings/hello" target="_blank" rel="noopener noreferrer">http://localhost:3000/greetings/hello<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/the_basic/CSRF Protection.html" class="prev">
        CSRF Protection
      </a></span> <span class="next"><a href="/the_basic/Request.html">
        Request
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.7adc5413.js" defer></script><script src="/assets/js/2.72a95a92.js" defer></script><script src="/assets/js/34.76b65e88.js" defer></script>
  </body>
</html>
